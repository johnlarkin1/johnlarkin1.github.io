<!DOCTYPE html><html lang="en-US"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta property="og:image" content="http://localhost:4000/assets/img/posts/cryptocurrency-meta.jpg"> <!-- Begin Jekyll SEO tag v2.8.0 --><title>CryptoCraze - Google Sheets Price Update | Where will you go next?</title><meta name="generator" content="Jekyll v3.9.2" /><meta property="og:title" content="CryptoCraze - Google Sheets Price Update" /><meta name="author" content="johnlarkin1" /><meta property="og:locale" content="en_US" /><meta name="description" content="Text messages are fun… but an excel / Google Sheets spreadsheet is also great for organization." /><meta property="og:description" content="Text messages are fun… but an excel / Google Sheets spreadsheet is also great for organization." /><link rel="canonical" href="http://localhost:4000/2018/crypto-google-sheets-update/" /><meta property="og:url" content="http://localhost:4000/2018/crypto-google-sheets-update/" /><meta property="og:site_name" content="Where will you go next?" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-01-05T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="CryptoCraze - Google Sheets Price Update" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"johnlarkin1"},"dateModified":"2018-01-05T00:00:00-05:00","datePublished":"2018-01-05T00:00:00-05:00","description":"Text messages are fun… but an excel / Google Sheets spreadsheet is also great for organization.","headline":"CryptoCraze - Google Sheets Price Update","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2018/crypto-google-sheets-update/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/images/mountain.png"},"name":"johnlarkin1"},"url":"http://localhost:4000/2018/crypto-google-sheets-update/"}</script> <!-- End Jekyll SEO tag --><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icons/apple-touch-icon.png?v=qA3OXqyw77"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/icons/favicon-32x32.png?v=qA3OXqyw77"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/icons/favicon-16x16.png?v=qA3OXqyw77"><link rel="manifest" href="/assets/img/icons/manifest.json?v=qA3OXqyw77"><link rel="mask-icon" href="/assets/img/icons/safari-pinned-tab.svg?v=qA3OXqyw77" color="#5bbad5"> <!--[if IE]><link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77"><![endif]--><link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77"><meta name="apple-mobile-web-app-title" content="Sleek"><meta name="application-name" content="Sleek"><meta name="msapplication-config" content="/assets/img/icons/browserconfig.xml?v=qA3OXqyw77"><meta name="theme-color" content="#ffffff"> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=GTM-KDHGNV6"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'GTM-KDHGNV6'); </script><style class="inlineCSS"> h1{color:#313237;margin-top:0;margin-bottom:.5rem}.dark-bg{background-color:#313237}@media only screen and (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:last-of-type,.post-card:nth-child(2n+2){margin-right:0}}html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figure,main{display:block}figure{margin:1em 40px}a{background-color:transparent;-webkit-text-decoration-skip:objects}img{border-style:none}svg:not(:root){overflow:hidden}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{-webkit-box-sizing:border-box;box-sizing:border-box}body{-webkit-overflow-scrolling:touch}*,::after,::before{-webkit-box-sizing:inherit;box-sizing:inherit}.site{display:-webkit-box;display:-ms-flexbox;display:flex;min-height:100vh;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.site__content{-webkit-box-flex:1;-ms-flex:1;flex:1}img{max-width:100%;height:auto;width:auto;vertical-align:middle}figure{margin:0}body{background-color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Hiragino Sans GB","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif;font-size:1rem;line-height:1.5;color:#343851;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%}p{margin-top:0;margin-bottom:1.25rem}h1,h2{color:#313237;margin-top:0;margin-bottom:.5rem}a{color:#277cea;text-decoration:none;border-bottom:1px dashed #277cea}.blur{background:#fff;filter:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg"><filter id="filter"><feGaussianBlur stdDeviation="16" /></filter></svg>#filter');-webkit-filter:blur(1rem);filter:blur(1rem)}.container{padding:0 20px;max-width:100%;margin:0 auto}@media only screen and (min-width:36em){.container{max-width:540px;margin:0 auto}}@media only screen and (min-width:48em){.container{max-width:720px;margin:0 auto}}@media only screen and (min-width:62em){.container{max-width:960px;margin:0 auto}}@media only screen and (min-width:75em){.container{max-width:1170px;margin:0 auto}}.header{background-color:#fff;color:#343851;position:absolute;z-index:4;width:100%;top:0;left:0;will-change:transform;-webkit-transform:translateY(0);transform:translateY(0)}.header a{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:0}.header__logo{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;overflow:hidden;padding:19px 0;margin-right:1.25rem;outline:0;border-bottom:0;color:#313237}.header__logo .header__logo--container{width:58px}.header__logo .header__logo--container .logo{fill:currentColor}.header__inner{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:3.75em;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.header__links{padding-bottom:.5rem;display:none;position:absolute;top:3.75em;left:0;width:100%;height:auto;background:#fff}.header__link{color:#343851;padding:.938rem 0;border-top:1px solid #ededed}.header__toggle{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:44px;height:100%;background-color:transparent;padding-left:1.25rem}.header__toggle span{display:block;position:relative;margin-top:4px;background-color:#343851;width:100%;height:2px;border-radius:1px}.header__toggle span:first-child{margin-top:0}@media (min-width:62em){.header__toggle{display:none;visibility:hidden}.header__links{position:static;padding:0;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;visibility:visible;width:auto;height:100%}.header__links-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;padding:0}.header__link{position:relative;padding:.938rem 1rem;border:0;height:100%}.header__link::after{content:"";display:block;position:absolute;left:0;bottom:0;height:3px;width:100%;-webkit-transform:scaleX(0);transform:scaleX(0);background:#277cea}}.post-card{display:block;position:relative;width:100%;min-height:250px;border-radius:4px;overflow:hidden;background-color:#fff;-webkit-box-shadow:0 1px 3px rgba(0,0,0,.08);box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:2.25rem;border-bottom:0}@media only screen and (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:0}}@media only screen and (min-width:75em){.post-card{width:31.25%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:3.125%}}.post-card__label{position:absolute;top:1.5rem;left:1.5rem;z-index:2}.post-card__inner{display:block;position:relative;padding:1.875rem 1.25rem .625rem;width:100%;color:#838c8d;border-bottom:0}.post-card__header{margin-bottom:.75rem}.post-card__meta{font-size:.875rem}.post-card__thumb{margin:0;background:#fff;position:relative;overflow:hidden}.post-card__thumb::after{content:"";display:block;height:0;width:100%;padding-bottom:56.25%}.post-card__thumb>*{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.label{padding:0 10px;margin-bottom:1rem;display:inline-block;line-height:20px;font-size:.75rem;text-transform:uppercase;letter-spacing:1px;color:rgba(255,255,255,.8);border:2px solid rgba(255,255,255,.5);border-radius:100px}.hero{margin:3.75rem auto 0;min-height:16.25rem;width:100%;position:relative;background-color:#dde5ea;background-repeat:no-repeat;background-position:50%;background-size:cover}@media only screen and (min-width:62em){.hero{margin:0 auto;height:36em}}.hero::before{position:absolute;display:block;content:"";top:0;left:0;width:100%;height:100%;background:rgba(52,56,81,.8)}.hero__wrap{position:absolute;margin:auto;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);text-align:center;color:rgba(255,255,255,.8);width:100%;max-width:90%;z-index:1}.hero__wrap .hero__title{font-size:1.8em;color:#fff}.blog{background-color:#f9f9f9}.post-list{padding-top:2.5em;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto}@media only screen and (min-width:48em){.hero__wrap{max-width:40em}.hero__wrap .hero__title{padding:1rem 0;font-size:2.625em;line-height:3.125rem}.post-list{padding-top:5em}}</style><link rel="preload" href="/assets/css/main.css" as="style" onload="this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="/assets/css/main.css"></noscript> <script type="text/javascript"> /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */ (function(w){"use strict";if(!w.loadCSS){w.loadCSS=function(){}} var rp=loadCSS.relpreload={};rp.support=(function(){var ret;try{ret=w.document.createElement("link").relList.supports("preload")}catch(e){ret=!1} return function(){return ret}})();rp.bindMediaToggle=function(link){var finalMedia=link.media||"all";function enableStylesheet(){link.media=finalMedia} if(link.addEventListener){link.addEventListener("load",enableStylesheet)}else if(link.attachEvent){link.attachEvent("onload",enableStylesheet)} setTimeout(function(){link.rel="stylesheet";link.media="only x"});setTimeout(enableStylesheet,3000)};rp.poly=function(){if(rp.support()){return} var links=w.document.getElementsByTagName("link");for(var i=0;i<links.length;i++){var link=links[i];if(link.rel==="preload"&&link.getAttribute("as")==="style"&&!link.getAttribute("data-loadcss")){link.setAttribute("data-loadcss",!0);rp.bindMediaToggle(link)}}};if(!rp.support()){rp.poly();var run=w.setInterval(rp.poly,500);if(w.addEventListener){w.addEventListener("load",function(){rp.poly();w.clearInterval(run)})}else if(w.attachEvent){w.attachEvent("onload",function(){rp.poly();w.clearInterval(run)})}} if(typeof exports!=="undefined"){exports.loadCSS=loadCSS} else{w.loadCSS=loadCSS}}(typeof global!=="undefined"?global:this)) </script></head><body class="site"> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KDHGNV6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) --><header class="header" itemscope itemtype="http://schema.org/SiteNavigationElement" aria-label="Main navigation"><div class="container"><div class="header__inner"> <a class="header__logo" href="/"><div class="header__logo--container"> <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 294.779 205.349"><defs><style>.cls-1{fill:#fff;}.cls-2{font-size:28px;font-family:Roboto-Medium, Roboto;font-weight:500;}</style></defs><path d="M177.284,200.364a80.333,80.333,0,0,0-16.5,6c-7.8,3.9-11,6.2-18.1,13.3-13.9,14-20.2,29.2-20.3,49.1-.1,12.8,1.3,18.7,7,30.8,14,29.2,47.8,45.1,78.9,37.2,14.7-3.8,29-13.2,44-29.2l7.5-8,7.5,8c15,16,29.3,25.4,44,29.2,36.3,9.3,74.5-13.9,84.2-51,2.3-8.7,2.3-25.3,0-34a95.883,95.883,0,0,0-5.9-15c-7.7-15.8-24.3-29.6-42.2-35.2-8.1-2.5-22.4-3.4-31.1-1.9-15.9,2.8-33.4,12.5-48.4,26.8l-8.2,7.9-8.1-7.9C228.184,203.964,203.384,195.164,177.284,200.364Z" transform="translate(-112.404 -133.469)"/><path class="cls-1" d="M348.384,203.264c19.3,6.4,32.8,18.5,41.5,37,5.9,12.7,7.6,25.5,4.6,34.1-5.4,15.2-15,23.1-32.5,27-8.8,2-28.4,1.5-34.7-.8l-3.9-1.5,5.4-.7c24.7-3.2,35.2-32.1,18.2-50a34.28,34.28,0,0,0-17.9-9.2c-9-1.3-20,5-34.7,20.1l-8.1,8.3-8.1-10.1c-4.5-5.6-10.3-12.8-12.9-16l-4.8-5.8,5.9-6c14.7-15,32.2-25.2,49.5-28.9C323.684,199.164,339.684,200.364,348.384,203.264Z" transform="translate(-112.404 -133.469)"/><path class="cls-1" d="M184.684,227.864a58.838,58.838,0,0,1,21.5,13c3.6,3.3,6.5,6.4,6.4,6.7-.1.4,4.2,5.1,9.5,10.4,5.3,5.4,9.7,10.2,9.7,10.6,0,1.6-11.9,14-18.3,19-9.4,7.4-14.1,9.6-21,9.5-20-.3-33.2-22.4-24.3-40.7,7.8-16,28.2-20.9,40.9-9.8.9.8,2,1.2,2.3.9,1-1-8.1-6.3-13.1-7.7-11.1-3.1-25.7,4.6-31.6,16.8-3.2,6.7-3.2,17.8.1,24.6,5.9,12.2,20.3,19.7,31.7,16.7,6.3-1.7,15.9-8.7,25.8-18.7l9-9.1,9.5,10.4c5.2,5.7,11,12.2,12.9,14.4l3.4,3.9-9.4,9.6c-16.6,16.9-29.3,24.9-44.9,28-38.4,7.7-75.4-19.2-81-58.8-2.3-16.1,3.1-33.1,13.4-42,2.8-2.4,10.1-6.2,15.1-7.8C160.884,224.964,175.784,224.964,184.684,227.864Z" transform="translate(-112.404 -133.469)"/><path class="cls-1" d="M338.484,243.364c9.8,4.7,15.5,13.9,15.5,25.4,0,11.6-5.6,20.6-15.9,25.6-12.8,6.3-22.9,2.7-40-14.2-5.7-5.6-10.3-10.7-10.3-11.4,0-2.1,19.3-20.3,25.3-23.9C322.684,239.264,328.884,238.864,338.484,243.364Z" transform="translate(-112.404 -133.469)"/><text class="cls-2" transform="translate(0 55.323)">Where will you go next?</text><text x="-112.404" y="-133.469"/></svg></div></a><nav class="header__links"><div class="container header__links-wrapper"> <a class="header__link" href="/" itemprop="url"> <span itemprop="name">Home</span> </a> <a class="header__link" href="/about" itemprop="url"> <span itemprop="name">About</span> </a> <a class="header__link" href="/categories" itemprop="url"> <span itemprop="name">Categories</span> </a> <a class="header__link" href="/contact" itemprop="url"> <span itemprop="name">Contact</span> </a></div></nav><div class="header__toggle"> <span></span> <span></span> <span></span></div></div></div></header><div class="hero lazyload" data-bg="http://localhost:4000/assets/img/posts/cryptocurrency-meta.jpg"><div class="hero__wrap"><div class="hero__categories"> <a class="label" href="/categories/#Crypto">Crypto</a> &nbsp; <a class="label" href="/categories/#Development">Development</a></div><h1 class="hero__title">CryptoCraze - Google Sheets Price Update</h1><p class="hero__meta"> <span> <time>05 Jan 2018</time>&nbsp;&middot; </span> <span> 13 mins read </span></p></div></div><main class="site__content"><div class="container"><article class="post-content" itemprop="articleBody"><p>Text messages are fun… but an excel / Google Sheets spreadsheet is also great for organization.</p><p>The roomie (<a href="https://www.linkedin.com/in/joseph-willcox-will-jaroszewicz-27313466">Will J</a>) and I were curious about an organized way to automatically update current crypto metrics for an excel spreadsheet. We’ve got a couple of buddies who are trading and Will - being the bright Harvard stud that he is - pitched this idea to me saying that it would really help some of his friends out.</p><p>So I set out to create another cronjob that would run regularly to pull markets from once again, the CoinMarketCap API and disseminate the prices as we like. If you just want the code and you want to decipher what’s going on solely from that, <a href="https://github.com/johnlarkin1/crypto-sheets-update">here it is</a> and knock yourself out.</p><h1 id="main-idea">Main Idea</h1><p>The spreadsheet was going to have one column that lists the symbols of the cryptos that my friends are actively involved in. So the program should be able to read that column and parse all of the appropriate symbols and then make the corresponding call to <code class="language-plaintext highlighter-rouge">coinmarketcap</code> to search for the information that my buddies wanted to be displayed on a close-to-real-time level. So let’s break this up into parts for clearer understanding. Here’s a link to the generated html page.</p><h1 id="initial-setup">Initial Setup</h1><p>Now, I’m not going to go into using the <code class="language-plaintext highlighter-rouge">coinmarketcap</code> python package - firstly, because it’s simple to use and secondly, because I already did in this <a href="https://johnlarkin1.github.io/2017/12/12/crypto-notifications.html">blog post</a>. I suggest you check out that one if you want to kind of understand the API and what’s going on.</p><p>However, the new piece of the puzzle that I was expanding on was connecting to Google Sheets, which has a great API. I wrote this program in python so the following was primarily the specific tutorial that I used to get started. You can find it <a href="https://developers.google.com/sheets/api/quickstart/python">here</a>.</p><p>Again, I’m not going to go into the exact details on setting up connection for the API, but I will say that I do think it’s fundamental for you to be able to get the <code class="language-plaintext highlighter-rouge">quickstart.py</code> program that Google provides. Again, see step #3 <a href="https://developers.google.com/sheets/api/quickstart/python">here</a>.</p><p>Once everything is good there and you’re able to successfully print out the names and majors of a dummy open spreadsheet that Google provides, then the world is yours and you can really get cracking. Writing to sheets is just another method call to the service. There’s a couple of things of importance that are to highlight.</p><p>However, we do need a little bit of specific information about the spreadsheet that you’re trying to work with. Google in their quickstart program uses a <a href="https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit">dummy excel spreadsheet</a>. You can find the actual program <a href="https://developers.google.com/sheets/api/quickstart/python">here</a>. A couple things about the terminology that the API tutorial uses can be found <a href="https://developers.google.com/sheets/api/guides/concepts">here</a>. But I’ll cover them quickly below. Let’s look at the url of the dummy sheet.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit#gid=0
</code></pre></div></div><p>This can be broken into a couple of main parts</p><p>The <code class="language-plaintext highlighter-rouge">id</code> portion of this spreadsheet is everything between the <code class="language-plaintext highlighter-rouge">d/</code> and the <code class="language-plaintext highlighter-rouge">/edit</code> bit. That means this spreadsheet id is</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms
</code></pre></div></div><p>The <code class="language-plaintext highlighter-rouge">sheetId</code> portion of the spreadsheet is what comes after the <code class="language-plaintext highlighter-rouge">edit#gid=</code> bit. So this has a sheetId of</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
</code></pre></div></div><p>Those are really the two important things you’ll need.</p><p>So the way I arranged the program was to pull from a yaml. The yaml file looks like</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spreadsheet_id: &lt;insert yours here&gt;
sheet_id: &lt;insert yours here&gt;
update_time_range_name: &lt;insert yours here&gt;
to_write_range_name: &lt;insert yours here&gt;
crypto_ticker_range_name: &lt;insert yours here&gt;
value_input_option: &lt;either RAW or USER_ENTERED&gt;
</code></pre></div></div><p>I pushed up a dummy one with the commit as well. Also note, that Google designed the program to work that for the first time you actually log into the spreadsheet it will create a <code class="language-plaintext highlighter-rouge">client_secret.json</code> file and populate it with various params needed for the connection. After you log in once, you should be good to go.</p><p>For my yaml dictionary, we already talked about the ids. The range name is specified in A1 notation. There’s three ranges total. One range to specify the time you updated the spreadsheet (a helpful indication of if it was successfully done by your cronjob). One range is to pull the crypto symbols to specify what you care about. Then a final range so that you’re able to write all of the information you want into that reason. Anyway, let’s expand a bit further.</p><h1 id="reading-the-data">Reading the Data</h1><p>The actual code that reqads the data and parses the tickert is as simple as this.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">spreadsheets</span><span class="p">().</span><span class="n">values</span><span class="p">().</span><span class="n">get</span><span class="p">(</span>
    <span class="n">spreadsheetId</span><span class="o">=</span><span class="n">spreadsheet_id</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">crypto_symbol_range_name</span><span class="p">).</span><span class="n">execute</span><span class="p">()</span>
<span class="c1"># Saying if values doesn't exist, return [] as default value. Values is a list of lists.
# List per every row.
</span><span class="n">read_values</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'values'</span><span class="p">,</span> <span class="p">[])</span> 
<span class="n">flat_list_of_symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">read_values</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
</code></pre></div></div><p>Note a couple of things. We had to flatten the list of lists to make the pertinent data more easily readable. This is because you get a list per every row that is read.</p><p>Secondly, the call to read is really simple. It’s really just paying close attention to the format that everything is in so that the reading and writing is done cleanly.</p><h1 id="writing-the-data">Writing the Data</h1><p>This was a bit more of the fun part. So from above, we have our flat_list_of_symbols. So this is going to be like:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Flat list of symbols: [u'BTC', u'ETH', u'MIOTA', u'XRP]
</code></pre></div></div><p>So that’s bitcoin, ethereum, iota, and ripple for example. A random example of what one might be interested in.</p><p>We’ve got this list and we want to get let’s say the prices, the marketcap, and percent change for the past 24 hours since the time of the query. Luckily for us, this information is all provided by the CoinMarketCap API.</p><p>We run into an issue here. Mainly, the size of the data that we care about. We don’t want to truncate the amount of market data that we’ve actually grabbed because who knows - maybe my lunatic friends are betting big on some small crypto that just barely crept into the top 100 in terms of market cap. But at the same time, we don’t want to have to iterate over this entire 100 length list of dictionaries to find the crypto information that we care about. The final thing is that order does matter here. We received the crypto symbols in an order from top to bottom in terms of the column. We want to write the correct price, market cap, and percent change that corresponds with the right crypto. So we need to ensure that we’re at least iterating over the flattened list of symbols in order.</p><p>So that’s fine, but then I didn’t think it would be optimal to have a double for loop with the inner loop iterating once every 100 times. This means the big O of this specific step would be \(O(100 * n)\) where \(n\) is the number of cryptos that my buddies are invested in. <em>Technically</em>, that’s still linear because the size of the inner loop is fixed, but we’re not dealing with theory of comp here. We’re dealing with actual time. So I figured it’d be a lot better to filter our list of dictionaries to only contain relevant cryptos. Again, now it’s <em>theoretically</em> \(O(n^2)\) but <em>in reality</em> (which is what we live in) this is going to be optimized to the first approach. One other step that we can take to optimize the runtime of the loop is to break as soon as we find the right values to append. The other thing we need to be cautious of is - ok well what’s the runtime of the filter operation? I’m guessing linear, but it’s also written in C or C++ backend, so I’ll take that essentially anyday.</p><p>Anyway, the final result for grabbing the crypto price, market cap, and percent change for the past 24 hours is just these clean pythonic couple of lines.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filt_crypto_market_info</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">'symbol'</span><span class="p">]</span> <span class="ow">in</span> <span class="n">flat_list_of_symbols</span><span class="p">,</span> <span class="n">crypto_market_info</span><span class="p">))</span>
<span class="k">for</span> <span class="n">crypto_symbol</span> <span class="ow">in</span> <span class="n">list_of_symbols</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">crypto_info</span> <span class="ow">in</span> <span class="n">crypto_market_info</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">crypto_symbol</span> <span class="o">==</span> <span class="n">crypto_info</span><span class="p">[</span><span class="s">'symbol'</span><span class="p">]:</span>
            <span class="n">values_to_write</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">crypto_info</span><span class="p">[</span><span class="s">'price_usd'</span><span class="p">],</span> <span class="n">crypto_info</span><span class="p">[</span><span class="s">'market_cap_usd'</span><span class="p">],</span> <span class="n">crypto_info</span><span class="p">[</span><span class="s">'percent_change_24h'</span><span class="p">]</span> <span class="o">+</span> <span class="s">'%'</span><span class="p">])</span> <span class="c1"># need to add % for excel
</span>            <span class="k">break</span>
</code></pre></div></div><h1 id="formatting-the-data-correctly">Formatting the Data Correctly</h1><p>Again, another slightly tricky part of this program was the fluctuation between the google sheets API call. If you’re doing multiple updates per one batch call you need to format the data differently than say if you were to only update one range of cells. Otherwise, the google sheets API will complain about it. Specifically, for the way I’m doing it, we need to store the data we want to write as a value in a dictionary that we pass to the API call. The type of the data is a list of dictionaries that correspond to the values to write for each block. So it’s decently nested which can make debugging slightly tricky.</p><p>The writing portion is pretty much handled my the API call which makes this really nice and clean. So I’m not going to cover anything about that.</p><h1 id="emailing-the-spreadsheet-after-update">Emailing the Spreadsheet After Update</h1><p>Also because I figured that it was too much for my friends to actually check the spreadsheet on a mobile device or like text me and ask if I’ve updated it yet, I set up a cronjob and also wrote a google sheets function which was a first for me.</p><p>What you can do is go to <code class="language-plaintext highlighter-rouge">Tools &gt; Script editor... &gt; Create new project</code> and then pretty much just go to town. You can also automate when this new project is called, so I just did twice a day. The google scripting language is very similar to javascript, which I have a very limited proficiency in but I was able to get the job done here.</p><p>Here’s the code that builds the email and sends a saved pdf that has all the information of the spreadsheet. Rather than generated text, the pdf actually preserves format and highlighting (and it’s already there) so I figured I’d use that.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">createAndSendPDF</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActiveSheet</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">spreadsheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActiveSpreadsheet</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">documentProperties</span> <span class="o">=</span> <span class="nx">PropertiesService</span><span class="p">.</span><span class="nx">getDocumentProperties</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActiveSpreadsheet</span><span class="p">().</span><span class="nx">getEditors</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">emailBuilder</span> <span class="o">=</span> <span class="dl">''</span>
  
  <span class="c1">// Build up the emails</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">users</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">emailBuilder</span> <span class="o">=</span> <span class="nx">emailBuilder</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">users</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getEmail</span><span class="p">());</span>
    <span class="kd">var</span> <span class="nx">emailBuilder</span> <span class="o">=</span> <span class="nx">emailBuilder</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="c1">// Trim off excess comma</span>
  <span class="kd">var</span> <span class="nx">emailBuilder</span> <span class="o">=</span> <span class="nx">emailBuilder</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">emailBuilder</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  
  <span class="c1">// This is going to be the message in the email</span>
  <span class="kd">var</span> <span class="nx">messageInEmail</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Please see the attached for your daily crypto report #hodl</span><span class="dl">'</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">subjectOfEmail</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Daily CryptoCM Update</span><span class="dl">'</span>
  
  <span class="c1">// Generate pdf</span>
  <span class="kd">var</span> <span class="nx">pdf</span> <span class="o">=</span> <span class="nx">DriveApp</span><span class="p">.</span><span class="nx">getFileById</span><span class="p">(</span><span class="nx">spreadsheet</span><span class="p">.</span><span class="nx">getId</span><span class="p">()).</span><span class="nx">getAs</span><span class="p">(</span><span class="dl">'</span><span class="s1">application/pdf</span><span class="dl">'</span><span class="p">).</span><span class="nx">getBytes</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">attach</span> <span class="o">=</span> <span class="p">{</span><span class="na">fileName</span><span class="p">:</span><span class="dl">'</span><span class="s1">Daily CryptoCM Report.pdf</span><span class="dl">'</span><span class="p">,</span><span class="na">content</span><span class="p">:</span><span class="nx">pdf</span><span class="p">,</span> <span class="na">mimeType</span><span class="p">:</span><span class="dl">'</span><span class="s1">application/pdf</span><span class="dl">'</span><span class="p">};</span>

  <span class="c1">// Send the freshly constructed email </span>
  <span class="nx">MailApp</span><span class="p">.</span><span class="nx">sendEmail</span><span class="p">(</span><span class="nx">emailBuilder</span><span class="p">,</span> <span class="nx">subjectOfEmail</span><span class="p">,</span> <span class="nx">messageInEmail</span><span class="p">,</span> <span class="p">{</span><span class="na">attachments</span><span class="p">:[</span><span class="nx">attach</span><span class="p">]});</span>
<span class="p">}</span>
</code></pre></div></div><h1 id="generating-documentation">Generating Documentation</h1><p>One other thing that I dipped my toes into with this project is pydoc and the ability to use pydoc style comments to generate a helpful html page just explaining the script and some of the function calls. Really, all you need to do is have:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pydoc -w &lt;name_of_python_file_without_extension&gt;
</code></pre></div></div><p>and the html file will get created automatically. Also, it’s important to note that you need to design your comments in a certain way in order for the parser to pick them up when the html doc is being created. I can’t really link it but if you pull it down from Github you can see what it would actually look like in a browser.</p><h1 id="finalizing-the-product">Finalizing the Product</h1><p>A good confirmation check is just running the script and making sure the updated time in your spreadsheet is recent and that all of the crypto metrics look correct. Another good check program side would be ensuring that the number of updated cells that is logged is what you want.</p><p>After that you’re good to go with setting up that cronjob to regularly pull in these prices if your friends want to be up to date with their returns and losses and current status of their portfolio. I’m not going to go into that detail with this post, but you can check out my other post <a href="https://johnlarkin1.github.io/2017/12/12/crypto-notifications.html">here</a>.</p><p>My typical comments at the end. Let me know if you think I can improve my code algorithmically, design-wise, better comments or whatever. I always appreciate the feedback. Thanks for reading as always. <a href="https://github.com/johnlarkin1/crypto-sheets-update">Here’s the code</a> if you didn’t already peek it!</p></article><div class="post-content controls__inner"><div class="controls__item prev"> <span>Previous</span> <a href="/2017/crypto-notifications/"> <span> <svg xmlns="http://www.w3.org/2000/svg" width="6" height="11"><path fill="fillColor" d="M5.647 1.718c.37-.434.323-1.09-.106-1.465A1.016 1.016 0 0 0 4.095.36L.25 4.875a1.05 1.05 0 0 0 .017 1.378l3.95 4.407c.38.424 1.03.456 1.448.07a1.05 1.05 0 0 0 .07-1.468l-3.34-3.725 3.253-3.819z"/> </svg> </span> CryptoCraze - Text Notifica... </a></div><div class="controls__item next"> <span>Next</span> <a href="/2018/ror-intro/"> Ruby on Rails Introduction ... <span> <svg xmlns="http://www.w3.org/2000/svg" width="6" height="11"><path fill="#fillColor" d="M.353 9.282c-.37.434-.323 1.09.106 1.465a1.016 1.016 0 0 0 1.446-.107L5.75 6.125a1.05 1.05 0 0 0-.017-1.378L1.784.34A1.015 1.015 0 0 0 .336.27a1.05 1.05 0 0 0-.07 1.468l3.34 3.725L.353 9.282z"/> </svg> </span> </a></div></div></div><div class="comments"><div class="container"><div class="post-content"><div id="disqus_thread"></div><script> var disqus_config = function () { this.page.url = 'http://localhost:4000/2018/crypto-google-sheets-update/'; this.page.identifier = 'http://localhost:4000/2018/crypto-google-sheets-update/'; }; (function() { var d = document, s = d.createElement('script'); s.src = 'https://jlarks32.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the comments.</noscript></div></div></div></main><footer class="footer"><div class="container"><nav class="social"> <a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/johnlarkin1"> <svg class="social__icon" viewBox="0 0 20 20" width="20px" height="20px"><path d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg> </a></nav><span>&copy; 2024 Where will you go next?. All rights reserved.</span></div></footer><script async src="/assets/js/bundle.js"></script></body></html>
