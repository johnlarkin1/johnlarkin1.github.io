<!DOCTYPE html><html lang="en-US"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --><title>Porvata and SPAR Integration | Where will you go next?</title><meta name="generator" content="Jekyll v3.9.1" /><meta property="og:title" content="Porvata and SPAR Integration" /><meta name="author" content="johnlarkin1" /><meta property="og:locale" content="en_US" /><meta name="description" content="I got to work with my best friend on an interesting development project. This was by far one of my favorite pieces of development work I’ve done." /><meta property="og:description" content="I got to work with my best friend on an interesting development project. This was by far one of my favorite pieces of development work I’ve done." /><link rel="canonical" href="http://localhost:4000/2022/porvata-dev/" /><meta property="og:url" content="http://localhost:4000/2022/porvata-dev/" /><meta property="og:site_name" content="Where will you go next?" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-27T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Porvata and SPAR Integration" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"johnlarkin1"},"@type":"BlogPosting","description":"I got to work with my best friend on an interesting development project. This was by far one of my favorite pieces of development work I’ve done.","headline":"Porvata and SPAR Integration","dateModified":"2022-03-27T00:00:00-05:00","datePublished":"2022-03-27T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2022/porvata-dev/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/images/mountain.png"},"name":"johnlarkin1"},"url":"http://localhost:4000/2022/porvata-dev/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icons/apple-touch-icon.png?v=qA3OXqyw77"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/icons/favicon-32x32.png?v=qA3OXqyw77"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/icons/favicon-16x16.png?v=qA3OXqyw77"><link rel="manifest" href="/assets/img/icons/manifest.json?v=qA3OXqyw77"><link rel="mask-icon" href="/assets/img/icons/safari-pinned-tab.svg?v=qA3OXqyw77" color="#5bbad5"> <!--[if IE]><link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77"><![endif]--><link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77"><meta name="apple-mobile-web-app-title" content="Sleek"><meta name="application-name" content="Sleek"><meta name="msapplication-config" content="/assets/img/icons/browserconfig.xml?v=qA3OXqyw77"><meta name="theme-color" content="#ffffff"> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=GTM-KDHGNV6"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'GTM-KDHGNV6'); </script><style class="inlineCSS"> h1{color:#313237;margin-top:0;margin-bottom:.5rem}.dark-bg{background-color:#313237}@media only screen and (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:last-of-type,.post-card:nth-child(2n+2){margin-right:0}}html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figure,main{display:block}figure{margin:1em 40px}a{background-color:transparent;-webkit-text-decoration-skip:objects}img{border-style:none}svg:not(:root){overflow:hidden}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{-webkit-box-sizing:border-box;box-sizing:border-box}body{-webkit-overflow-scrolling:touch}*,::after,::before{-webkit-box-sizing:inherit;box-sizing:inherit}.site{display:-webkit-box;display:-ms-flexbox;display:flex;min-height:100vh;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.site__content{-webkit-box-flex:1;-ms-flex:1;flex:1}img{max-width:100%;height:auto;width:auto;vertical-align:middle}figure{margin:0}body{background-color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Hiragino Sans GB","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif;font-size:1rem;line-height:1.5;color:#343851;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%}p{margin-top:0;margin-bottom:1.25rem}h1,h2{color:#313237;margin-top:0;margin-bottom:.5rem}a{color:#277cea;text-decoration:none;border-bottom:1px dashed #277cea}.blur{background:#fff;filter:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg"><filter id="filter"><feGaussianBlur stdDeviation="16" /></filter></svg>#filter');-webkit-filter:blur(1rem);filter:blur(1rem)}.container{padding:0 20px;max-width:100%;margin:0 auto}@media only screen and (min-width:36em){.container{max-width:540px;margin:0 auto}}@media only screen and (min-width:48em){.container{max-width:720px;margin:0 auto}}@media only screen and (min-width:62em){.container{max-width:960px;margin:0 auto}}@media only screen and (min-width:75em){.container{max-width:1170px;margin:0 auto}}.header{background-color:#fff;color:#343851;position:absolute;z-index:4;width:100%;top:0;left:0;will-change:transform;-webkit-transform:translateY(0);transform:translateY(0)}.header a{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:0}.header__logo{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;overflow:hidden;padding:19px 0;margin-right:1.25rem;outline:0;border-bottom:0;color:#313237}.header__logo .header__logo--container{width:58px}.header__logo .header__logo--container .logo{fill:currentColor}.header__inner{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:3.75em;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.header__links{padding-bottom:.5rem;display:none;position:absolute;top:3.75em;left:0;width:100%;height:auto;background:#fff}.header__link{color:#343851;padding:.938rem 0;border-top:1px solid #ededed}.header__toggle{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:44px;height:100%;background-color:transparent;padding-left:1.25rem}.header__toggle span{display:block;position:relative;margin-top:4px;background-color:#343851;width:100%;height:2px;border-radius:1px}.header__toggle span:first-child{margin-top:0}@media (min-width:62em){.header__toggle{display:none;visibility:hidden}.header__links{position:static;padding:0;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;visibility:visible;width:auto;height:100%}.header__links-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;padding:0}.header__link{position:relative;padding:.938rem 1rem;border:0;height:100%}.header__link::after{content:"";display:block;position:absolute;left:0;bottom:0;height:3px;width:100%;-webkit-transform:scaleX(0);transform:scaleX(0);background:#277cea}}.post-card{display:block;position:relative;width:100%;min-height:250px;border-radius:4px;overflow:hidden;background-color:#fff;-webkit-box-shadow:0 1px 3px rgba(0,0,0,.08);box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:2.25rem;border-bottom:0}@media only screen and (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:0}}@media only screen and (min-width:75em){.post-card{width:31.25%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:3.125%}}.post-card__label{position:absolute;top:1.5rem;left:1.5rem;z-index:2}.post-card__inner{display:block;position:relative;padding:1.875rem 1.25rem .625rem;width:100%;color:#838c8d;border-bottom:0}.post-card__header{margin-bottom:.75rem}.post-card__meta{font-size:.875rem}.post-card__thumb{margin:0;background:#fff;position:relative;overflow:hidden}.post-card__thumb::after{content:"";display:block;height:0;width:100%;padding-bottom:56.25%}.post-card__thumb>*{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.label{padding:0 10px;margin-bottom:1rem;display:inline-block;line-height:20px;font-size:.75rem;text-transform:uppercase;letter-spacing:1px;color:rgba(255,255,255,.8);border:2px solid rgba(255,255,255,.5);border-radius:100px}.hero{margin:3.75rem auto 0;min-height:16.25rem;width:100%;position:relative;background-color:#dde5ea;background-repeat:no-repeat;background-position:50%;background-size:cover}@media only screen and (min-width:62em){.hero{margin:0 auto;height:36em}}.hero::before{position:absolute;display:block;content:"";top:0;left:0;width:100%;height:100%;background:rgba(52,56,81,.8)}.hero__wrap{position:absolute;margin:auto;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);text-align:center;color:rgba(255,255,255,.8);width:100%;max-width:90%;z-index:1}.hero__wrap .hero__title{font-size:1.8em;color:#fff}.blog{background-color:#f9f9f9}.post-list{padding-top:2.5em;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto}@media only screen and (min-width:48em){.hero__wrap{max-width:40em}.hero__wrap .hero__title{padding:1rem 0;font-size:2.625em;line-height:3.125rem}.post-list{padding-top:5em}}</style><link rel="preload" href="/assets/css/main.css" as="style" onload="this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="/assets/css/main.css"></noscript> <script type="text/javascript"> /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */ (function(w){"use strict";if(!w.loadCSS){w.loadCSS=function(){}} var rp=loadCSS.relpreload={};rp.support=(function(){var ret;try{ret=w.document.createElement("link").relList.supports("preload")}catch(e){ret=!1} return function(){return ret}})();rp.bindMediaToggle=function(link){var finalMedia=link.media||"all";function enableStylesheet(){link.media=finalMedia} if(link.addEventListener){link.addEventListener("load",enableStylesheet)}else if(link.attachEvent){link.attachEvent("onload",enableStylesheet)} setTimeout(function(){link.rel="stylesheet";link.media="only x"});setTimeout(enableStylesheet,3000)};rp.poly=function(){if(rp.support()){return} var links=w.document.getElementsByTagName("link");for(var i=0;i<links.length;i++){var link=links[i];if(link.rel==="preload"&&link.getAttribute("as")==="style"&&!link.getAttribute("data-loadcss")){link.setAttribute("data-loadcss",!0);rp.bindMediaToggle(link)}}};if(!rp.support()){rp.poly();var run=w.setInterval(rp.poly,500);if(w.addEventListener){w.addEventListener("load",function(){rp.poly();w.clearInterval(run)})}else if(w.attachEvent){w.attachEvent("onload",function(){rp.poly();w.clearInterval(run)})}} if(typeof exports!=="undefined"){exports.loadCSS=loadCSS} else{w.loadCSS=loadCSS}}(typeof global!=="undefined"?global:this)) </script></head><body class="site"> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KDHGNV6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) --><header class="header" itemscope itemtype="http://schema.org/SiteNavigationElement" aria-label="Main navigation"><div class="container"><div class="header__inner"> <a class="header__logo" href="/"><div class="header__logo--container"> <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 294.779 205.349"><defs><style>.cls-1{fill:#fff;}.cls-2{font-size:28px;font-family:Roboto-Medium, Roboto;font-weight:500;}</style></defs><path d="M177.284,200.364a80.333,80.333,0,0,0-16.5,6c-7.8,3.9-11,6.2-18.1,13.3-13.9,14-20.2,29.2-20.3,49.1-.1,12.8,1.3,18.7,7,30.8,14,29.2,47.8,45.1,78.9,37.2,14.7-3.8,29-13.2,44-29.2l7.5-8,7.5,8c15,16,29.3,25.4,44,29.2,36.3,9.3,74.5-13.9,84.2-51,2.3-8.7,2.3-25.3,0-34a95.883,95.883,0,0,0-5.9-15c-7.7-15.8-24.3-29.6-42.2-35.2-8.1-2.5-22.4-3.4-31.1-1.9-15.9,2.8-33.4,12.5-48.4,26.8l-8.2,7.9-8.1-7.9C228.184,203.964,203.384,195.164,177.284,200.364Z" transform="translate(-112.404 -133.469)"></path><path class="cls-1" d="M348.384,203.264c19.3,6.4,32.8,18.5,41.5,37,5.9,12.7,7.6,25.5,4.6,34.1-5.4,15.2-15,23.1-32.5,27-8.8,2-28.4,1.5-34.7-.8l-3.9-1.5,5.4-.7c24.7-3.2,35.2-32.1,18.2-50a34.28,34.28,0,0,0-17.9-9.2c-9-1.3-20,5-34.7,20.1l-8.1,8.3-8.1-10.1c-4.5-5.6-10.3-12.8-12.9-16l-4.8-5.8,5.9-6c14.7-15,32.2-25.2,49.5-28.9C323.684,199.164,339.684,200.364,348.384,203.264Z" transform="translate(-112.404 -133.469)"></path><path class="cls-1" d="M184.684,227.864a58.838,58.838,0,0,1,21.5,13c3.6,3.3,6.5,6.4,6.4,6.7-.1.4,4.2,5.1,9.5,10.4,5.3,5.4,9.7,10.2,9.7,10.6,0,1.6-11.9,14-18.3,19-9.4,7.4-14.1,9.6-21,9.5-20-.3-33.2-22.4-24.3-40.7,7.8-16,28.2-20.9,40.9-9.8.9.8,2,1.2,2.3.9,1-1-8.1-6.3-13.1-7.7-11.1-3.1-25.7,4.6-31.6,16.8-3.2,6.7-3.2,17.8.1,24.6,5.9,12.2,20.3,19.7,31.7,16.7,6.3-1.7,15.9-8.7,25.8-18.7l9-9.1,9.5,10.4c5.2,5.7,11,12.2,12.9,14.4l3.4,3.9-9.4,9.6c-16.6,16.9-29.3,24.9-44.9,28-38.4,7.7-75.4-19.2-81-58.8-2.3-16.1,3.1-33.1,13.4-42,2.8-2.4,10.1-6.2,15.1-7.8C160.884,224.964,175.784,224.964,184.684,227.864Z" transform="translate(-112.404 -133.469)"></path><path class="cls-1" d="M338.484,243.364c9.8,4.7,15.5,13.9,15.5,25.4,0,11.6-5.6,20.6-15.9,25.6-12.8,6.3-22.9,2.7-40-14.2-5.7-5.6-10.3-10.7-10.3-11.4,0-2.1,19.3-20.3,25.3-23.9C322.684,239.264,328.884,238.864,338.484,243.364Z" transform="translate(-112.404 -133.469)"></path><text class="cls-2" transform="translate(0 55.323)">Where will you go next?</text><text x="-112.404" y="-133.469"></text></svg>
</div></a><nav class="header__links"><div class="container header__links-wrapper"> <a class="header__link" href="/" itemprop="url"> <span itemprop="name">Home</span> </a> <a class="header__link" href="/about" itemprop="url"> <span itemprop="name">About</span> </a> <a class="header__link" href="/categories" itemprop="url"> <span itemprop="name">Categories</span> </a> <a class="header__link" href="/contact" itemprop="url"> <span itemprop="name">Contact</span> </a>
</div></nav><div class="header__toggle"> <span></span> <span></span> <span></span>
</div>
</div></div></header><div class="hero lazyload" data-bg="http://localhost:4000/assets/img/posts/porvata.jpg"><div class="hero__wrap">
<div class="hero__categories"> <a class="label" href="/categories/#Development">Development</a>   <a class="label" href="/categories/#Friendship">Friendship</a>   <a class="label" href="/categories/#Favorites">Favorites</a>
</div>
<h1 class="hero__title">Porvata and SPAR Integration</h1>
<p class="hero__meta"> <span> <time>27 Mar 2022</time> · </span> <span> 23 mins read </span></p>
</div></div><main class="site__content"><div class="container">
<article class="post-content" itemprop="articleBody"><p>I got to work with my best friend on an interesting development project. This was by far one of my favorite pieces of development work I’ve done.</p>
<h1 id="background">Background</h1>
<p>One of my best friends, <a href="https://www.linkedin.com/in/will-jaroszewicz-27313466/">Will Jaroszewicz</a> (see below (he’s the good looking one on the left)), and his brother, <a href="https://www.linkedin.com/in/nicholas-jaroszewicz/">Nick Jaroszewicz</a>, started a ecommerce retailer for home and office furniture in the middle of the pandemic named <a href="https://porvata.com/">Porvata</a>.</p>
<p><img src="/images/porvata-dev/will-and-i.jpg" alt="will-and-i" class="center-shrink"></p>
<p>Also this is from longer ago, but here’s a photo of Nick J and I (also Will and another Nick). Nick is on the right side, next to me.</p>
<p><img src="/images/porvata-dev/nick-will-nick-and-i.jpg" alt="nick-will-nick-and-i" class="center-shrink"></p>
<p><a href="https://porvata.com/">Porvata</a> helps to give consumers a better work from home setup, providing a range of great products like <a href="https://porvata.com/collections/all-desks/products/butcher-block-72-motorized-height-adjustable-standing-desk">72” desks</a> to <a href="https://porvata.com/collections/office-chairs/products/ergonomic-chair">ergonomic chairs</a> to even very helpful <a href="https://porvata.com/collections/wire-management-power-outlets/products/clamp-mounted-power-management">power strips</a> compatable with their desks. I’m obviosuly biased, but I have some of their products and endorse it heavily. I’d highly recommend anyone reading check it out for a couple minutes (at least for the site traffic / seo benefits).</p>
<p>As an aside, and this is more biased obviously, but I’ve seen how hard both Nick and Will have worked to grow <a href="https://porvata.com/">Porvata</a>, how much they care about the quality of their products, and how much they care about customer happiness and satisfaction. It’s been extremely rewarding and impressive to watch them grow the company. I’ve always loved them as friends but I never had a good glimpse into their professional tendencies and it’s just another facet into what makes them unique. It’s also been a lot of fun to work aside them for this quick little side project, and inspiring to me to keep growing and working.</p>
<p>So let’s dive in.</p>
<h1 id="table-of-contents">Table of Contents</h1>
<ul>
<li><a href="#background">Background</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#overview-of-architecture">Overview of Architecture</a></li>
<li>
<a href="#sweating-the-details">Sweating the Details</a><ul>
<li><a href="#-shopify-partners--shopify-partner-">[Shopify Partners][shopify-partner]</a></li>
<li>
<a href="#shopify-authentication">Shopify Authentication</a><ul><li><a href="#-ngrok--and-ssl-authentication"><code class="language-plaintext highlighter-rouge">ngrok</code> and SSL Authentication</a></li></ul>
</li>
<li>
<a href="#shopify-order-events">Shopify Order Events</a><ul><li><a href="#graphql">GraphQL</a></li></ul>
</li>
<li>
<a href="#posting-to-spar">Posting to SPAR</a><ul><li>
<a href="#interesting-questions">Interesting Questions</a><ul>
<li><a href="#dynamic-pricing-and-sku-checks">Dynamic Pricing and SKU Checks</a></li>
<li><a href="#zip-codes">Zip Codes</a></li>
<li><a href="#multiple-spar-legs">Multiple SPAR Legs</a></li>
<li><a href="#cancellations">Cancellations</a></li>
</ul>
</li></ul>
</li>
<li>
<a href="#extras-and-nice-to-haves">Extras and Nice-to-Haves</a><ul>
<li>
<a href="#email-notifications">Email Notifications</a><ul>
<li><a href="#order-received-event">Order Received Event</a></li>
<li><a href="#unknown-error-event">Unknown Error Event</a></li>
<li><a href="#outside-zip-code-event">Outside Zip Code Event</a></li>
<li><a href="#partial-order-fulfillment-event">Partial Order Fulfillment Event</a></li>
<li><a href="#full-order-fulfillment-event">Full Order Fulfillment Event</a></li>
</ul>
</li>
<li><a href="#additional-service-checking">Additional Service Checking</a></li>
<li><a href="#logging">Logging</a></li>
<li><a href="#linting-and-githooks">Linting and GitHooks</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<h1 id="introduction">Introduction</h1>
<p>Late into 2021, maybe around November, Will broached me saying that he might soon need a bit of development help on the backend side to tie together assembly integrations into orders. The gist is that <a href="https://porvata.com/">Porvata</a> would talk to <a href="https://sparinc.com/services/assembly-installation/">SPAR</a>, a third party company that would handle the assembly portion of orders. Before this, Will and Nick would often arrange for a TaskRabbit or some Fiver task if a customer personally emailed in and requested about assembly for one of their desks or chairs. After this, the goal was that customers could simply select assembly when going through the checkout process on <a href="https://porvata.com/">Porvata</a> and when the order shipped, they’d get a call and email from SPAR asking when a good time for them to handle assembly was. Ok cool.</p>
<p>So in theory, as most development projects go, this sounded pretty standard and relatively simple. But the fun parts came in with the details. So let’s get to that.</p>
<h1 id="overview-of-architecture">Overview of Architecture</h1>
<p>So my initial thoughts were basically the following. <a href="https://porvata.com/">Porvata</a> is a Shopify application (and we’ll get into that, but I’m a huge fan of Shopify (and now a shareholder (precisely 3 months to early to buy apparently))) so I figured that the developer services / events we could listen to would be pretty accessible. I figured that we could have some persistent service sitting on an EC2 instance listening to some Google Pub/Sub events and when we heard those events we could publish to the RESTful API that SPAR provides for the different types of events.</p>
<p>That was, and still is, the main design of the architecture but there’s a lot more that we wanted to add.</p>
<p>But again… this post is more wordy than even I have the attention span for, so I tried out <a href="https://www.lucidchart.com/pages/">Lucidchart</a> (of which I’m now a big fan of), and came up with this basic design flow:</p>
<p><img src="/images/porvata-dev/porvata-arch-overview.png" alt="porvata-arch-overview"></p>
<h1 id="sweating-the-details">Sweating the Details</h1>
<p>In <a href="https://www.dropbox.com/home">Dropbox</a> fashion, there turned out to be a lot of corner cases. I’m going to walk through in more detail the approach and how I iterated on this project.</p>
<h2 id="shopify-partners"><a href="https://www.shopify.com/partners">Shopify Partners</a></h2>
<p><a href="https://www.linkedin.com/in/will-jaroszewicz-27313466/">Will</a> and I talked about this to some degree about whether this should just be a standalone app that sits on some server or if I should jump through the hoops of being set up as a Shopify Partner. At first, I thought I could get by with simple webhooks and tokenization for either listening to events or some type of polling mechanism, but ultimately (and I think Shopify guided me this way), it seemed way more efficient to register as a Shopify Partner. And man, am I glad I did.</p>
<p>Here are some of the benefits that this provides:</p>
<ul>
<li>It’s <em>really</em> relatively painless<ul><li>There wasn’t a big delay or like secondary approval, it’s just signing up an account</li></ul>
</li>
<li>
<strong>Development testing</strong><ul><li>This was the big one. I - unfortunately - do not write perfect code. While unit tests help, it was nice to walk through with orders and simulate different customer actions.</li></ul>
</li>
<li>Hello, it’s fun?!<ul><li>I got to set up my own little Pet Store and simulate orders going through so that I could ensure we were parsing the data on the backend correctly as well as subscribing to the appropriate order events.</li></ul>
</li>
</ul>
<p>Alright <img class="emoji" title=":white_check_mark:" alt=":white_check_mark:" src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png" height="20" width="20"> so that portion has been good. I signed up as a Shopify Partner.</p>
<h2 id="shopify-authentication">Shopify Authentication</h2>
<p>This was the second big hurdle I had to jump through. And also fun enough, where I got to have some front end application.</p>
<p>Again, if you’re trying to set up your own custom app (awesome), but also I’d largely follow this content here: <a href="https://shopify.dev/apps/auth/oauth/getting-started">Shopify OAuth Tutorial</a></p>
<p>I’d recommend watching this <a href="https://www.dropbox.com/capture">Dropbox Capture</a> video (great product, again biased, but would recommend checking it out esp if you’re a Dropbox user. Think Loom but more natural integration):</p>
<p>Here’s two videos showing the brief UI interaction (with a screenshot)</p>
<p align="center"> <iframe src="https://www.dropbox.com/s/e9j24elsrkn16i1/BasicFunctionalityDemoPt1.mp4?raw=1" width="560" height="315" frameborder="0" allowfullscreen=""> </iframe></p>
<p align="center"> <iframe src="https://www.dropbox.com/s/miwsx5yrtz9fpjv/BasicFunctionalityDemoPt2.mp4?raw=1" width="560" height="315" frameborder="0" allowfullscreen=""> </iframe></p>
<p>And a corresponding screenshot:</p>
<p><img src="/images/porvata-dev/example-success.png" alt="example-success"></p>
<p>Note, I’m going to eventually try to share more of the code, but for now, I’m a bit protective over it because it’s largely shaped around the <a href="https://porvata.com/">Porvata</a> needs. There are some portions (like some utils and Shopify authentication) that I can share, so I’ll post that just as raw content here.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">compute_hmac_from_args</span><span class="p">(</span><span class="n">api_password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">args_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="s">"""Computing hmac from request args. Logic is to use all of the data minus the hmac key."""</span>
    <span class="nb">sorted</span><span class="p">(</span><span class="n">args_dict</span><span class="p">)</span>
    <span class="n">data_to_be_hashed</span> <span class="o">=</span> <span class="s">"&amp;"</span><span class="p">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s">"</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">args_dict</span><span class="p">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s">"hmac"</span><span class="p">]</span>
    <span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">)</span>
    <span class="n">EventLogger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">data_to_be_hashed</span><span class="p">)</span>
    <span class="n">comparison_hmac</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span>
        <span class="n">api_password</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">),</span> <span class="n">data_to_be_hashed</span><span class="p">,</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span>
    <span class="p">)</span>
    <span class="n">current_hmac</span> <span class="o">=</span> <span class="n">comparison_hmac</span><span class="p">.</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">current_hmac</span>


<span class="k">def</span> <span class="nf">is_nonce_the_same</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="s">"""Confirm that the session nonce is the same as the nonce from the current request."""</span>
    <span class="n">curr_nonce</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"state"</span><span class="p">)</span>
    <span class="n">session_nonce</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s">"nonce"</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">curr_nonce</span> <span class="o">!=</span> <span class="n">session</span><span class="p">[</span><span class="s">"nonce"</span><span class="p">]:</span>
        <span class="n">EventLogger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s">"Nonce's do not match. From request: </span><span class="si">{</span><span class="n">curr_nonce</span><span class="si">}</span><span class="s"> - from session: </span><span class="si">{</span><span class="n">session_nonce</span><span class="si">}</span><span class="s">"</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>


<span class="k">def</span> <span class="nf">is_hmac_valid</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="s">"""Confirm that the hmac is valid using our payload and `compute_hmac_from_args` call."""</span>
    <span class="n">basis_hmac</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"hmac"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">SHOPIFY_API_PASSWORD</span><span class="p">:</span>
        <span class="n">EventLogger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">"Did not have a SHOPIFY_API_PASSWORD"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="n">current_hmac</span> <span class="o">=</span> <span class="n">compute_hmac_from_args</span><span class="p">(</span><span class="n">SHOPIFY_API_PASSWORD</span><span class="p">,</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">)</span>
    <span class="n">EventLogger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"New hmac: </span><span class="si">{</span><span class="n">current_hmac</span><span class="si">}</span><span class="s"> ; Old hmac: </span><span class="si">{</span><span class="n">basis_hmac</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">current_hmac</span> <span class="o">!=</span> <span class="n">basis_hmac</span><span class="p">:</span>
        <span class="n">EventLogger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">"hmac's do not match up. Aborting."</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
</code></pre></div></div>
<h3 id="ngrok-and-ssl-authentication">
<code class="language-plaintext highlighter-rouge">ngrok</code> and SSL Authentication</h3>
<p>The one annoying for me (but good from Shopify) is that you are required to provide a HTTPS endpoint for authentication so I’m guessing your token can’t get sniffed or anything. That means that I had to run my flask server securely. I ended up turning to <a href="https://ngrok.com/product"><code class="language-plaintext highlighter-rouge">ngrok</code></a> which exposes the server behind a secure tunnel.</p>
<p>This was awesomel, but the downside is the free version (again, I’m cheap) of <a href="https://ngrok.com/product">Ngrok</a> is only available for 8 hours and so I built a little helper to automatically start the <code class="language-plaintext highlighter-rouge">ngrok</code> process if one wasn’t found on the VM and publish that endpoint. It does mean that the URL the Admin uses for authentication is basically only stable for 8 hours, but post authentication, they shouldn’t neeed to interact with the UI anymore.</p>
<hr>
<p>So great! Now we’re actually authenticating. We’re in the door. Now, we need to subscribe to the appropriate order events!</p>
<h2 id="shopify-order-events">Shopify Order Events</h2>
<p>Now, this is really where I became a buyer (both literally and metaphorically) of Shopify.</p>
<p>The sheer volume of things you can listen, query, and ask for from a developer’s perspective with Shopify is close to overwhelming. What we specifically were looking for is the <a href="https://shopify.dev/api/admin-rest/2022-01/resources/webhook#top">Shopify webhooks</a>. Webhooks are a perfect way in order to listen to various events that occur for your shop… like an order getting placed or fulfilled.</p>
<p>This is where a bit of the business sense had to come into play. At first, we were emailing SPAR when an order had gotten created, but that doesn’t really make sense does it? We didn’t want to call the customer as soon as they actually placed the order, because it could have been a couple days before the order was fulfilled and on its way to the customer. As a result, we needed to change from the <code class="language-plaintext highlighter-rouge">ORDERS_CREATE</code> event to the <code class="language-plaintext highlighter-rouge">ORDERS_FULFILLED</code> event.</p>
<p>You can read more about the various webhook subscription events to tie into <a href="https://shopify.dev/api/admin-graphql/2021-10/enums/WebhookSubscriptionTopic">here</a>. There’s also an example screenshot below:</p>
<p><img src="/images/porvata-dev/example-webhooks.png" alt="example-webhooks"></p>
<p>For the sake of what I was doing, there were a couple that I needed to subscribe to (I can get into that later). But let’s take a look at our nice pretty logs confirming we’ve subscribed to the various events.</p>
<p><img src="/images/porvata-dev/example-subscription-logs.png" alt="example-subscription-logs"></p>
<p>So ok another great step, we’re listening to the appropriate Pub/Sub events.</p>
<h3 id="graphql">GraphQL</h3>
<p>This also touched into a bit of GraphQL knowledge. Tying into any of these webhooks was not a RESTful call, but actually a <a href="https://graphql.org/">GraphQL</a> post. You can read more at the <a href="https://shopify.dev/api/admin-graphql#top">GraphQL Admin API Reference</a> from Shopify. The base endpoint that I used to register normally looked like this:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">webhook_subscription_query</span> <span class="o">=</span> <span class="s">"""mutation pubSubWebhookSubscriptionCreate($topic: WebhookSubscriptionTopic!,
        $webhookSubscription: PubSubWebhookSubscriptionInput!) {
    pubSubWebhookSubscriptionCreate(topic: $topic, webhookSubscription: $webhookSubscription) {
        webhookSubscription {
            id
            topic
            format
            endpoint {
                __typename
                ... on WebhookPubSubEndpoint {
                    pubSubProject
                    pubSubTopic
                }
            }
        }
    }
}"""</span>

</code></pre></div></div>
<h2 id="posting-to-spar">Posting to SPAR</h2>
<p>Ok so now we’ve basically got all the data that we need. The simple part was just extracting the appropriate information and sending that over to SPAR. Obviously, we only care about orders that have assembly in order to send to SPAR. So that meant that we needed some identifier. Given the UI and client facing design from <a href="https://porvata.com/">Porvata</a>, we found that the easiest solution was just to give assembly orders their own <a href="https://www.investopedia.com/terms/s/stock-keeping-unit-sku.asp#:~:text=A%20stock-keeping%20unit">SKU</a>, which I then would check for. If it fell in this <code class="language-plaintext highlighter-rouge">set</code> of valid SKUs, we would then check that it was in a valid zip code (covered below), and if so, bundle up the legs and send it over to spar. We’ll dive into some of these in more detail below.</p>
<h3 id="interesting-questions">Interesting Questions</h3>
<p>There were some interesting questions posed throughout this project.</p>
<h4 id="dynamic-pricing-and-sku-checks">Dynamic Pricing and SKU Checks</h4>
<blockquote><p>Can you guys send us the appopriate just price associated with just the assembly SKU?</p></blockquote>
<p>So one of the things we wanted was for high uptime of this service. Given that this is going to a customer and we’re fine with adding a little bit of latency making an additional network call, I wanted <a href="https://www.linkedin.com/in/will-jaroszewicz-27313466/">Will</a> to be able to add a SKU to the site, and have that be pulled in dynamically. We also wanted to extract specifically assembly pricing data, which because of how Shopify handled the presentation on the frontend, it was basically bundled into the total price. As a result, we decided to look at a private <a href="https://www.google.com/sheets/about/">Google Sheets</a> integration idea (something which I had also done in this <a href="/2018/crypto-google-sheets-update/">post</a>. So we are pulling a valid set of SKUs and mapping them to the corresponding broken out just assembly price that SPAR is interested in.</p>
<h4 id="zip-codes">Zip Codes</h4>
<blockquote><p>So, can we get assembly in every part of the US?</p></blockquote>
<p><a href="https://sparinc.com/services/assembly-installation/">SPAR</a> was a blast to work with. Their developers with prompt and their business contacts informative. I would recommend working with them. They cover a lot of territory as well, but unfortunately not every zip code in the US (they cover close to 18,000 and there are (<a href="https://facts.usps.com/42000-zip-codes/">according to USPS</a>) 41,683 US zip codes at the time of writing. Interesting note, apparently the USPS metadata for Google search might be broken though because there’s an inconsistency in <a href="https://www.google.com/search?q=how+many+zip+codes+are+in+the+US&amp;oq=how+many+zip+codes+are+in+the+US&amp;aqs=chrome..69i57.6923j1j7&amp;sourceid=chrome&amp;ie=UTF-8">this search</a>).</p>
<p>So this was a corner case that we obviously needed to support. <a href="https://porvata.com/">Porvata</a> services the entire US so a customer should be able to buy a desk anywhere, and the frontend (at this time) isn’t configured to filter results based on zip codes.</p>
<p>We actually ran into this a couple weeks back. A customer ordered assembly from an outside zip code. What actually happened was (I believe due to some casting between an <code class="language-plaintext highlighter-rouge">int</code> and a <code class="language-plaintext highlighter-rouge">str</code>), my service threw an error. I investigated, saw the bug, fixed the bug, <a href="https://cloud.google.com/pubsub/docs/replay-overview">replayed the event</a> (again, love love love GCP Pub/Sub), and we got the appropriate email notification that the customer was actually outside of the valid zip code set. <a href="https://www.linkedin.com/in/will-jaroszewicz-27313466/">Will</a> and <a href="https://www.linkedin.com/in/nicholas-jaroszewicz/">Nick</a> then took the appropriate actions, contacted the customer quickly, and set up a TaskRabbit for them to have assembly in another manner.</p>
<h4 id="multiple-spar-legs">Multiple SPAR Legs</h4>
<blockquote><p>What should we do when a customer orders assembly on multiple items, and they’re fulfilled at different times?</p></blockquote>
<p>This was another interesting one we saw a couple weeks back. A customer had multiple assembly items and so we piecewise uploaded each fulfillment to SPAR. This was… well… working like how I expected but maybe not ideally (and I probably should have thought about this). What we wanted to do instead was only send SPAR one notification, basically saying, “Hey, we’ve got this customer here are all their assembly legs, the last one just got fulfilled, give them a call”.</p>
<p>But on the flip side, let’s say there’s some crisis - like maybe a global pandemic or <a href="https://www.bbc.com/news/business-56559073">this</a> - and there’s a large delay between fulfillment orders. Let’s say so large in fact that the customer <strong>gets</strong> one of their items that is <em>meant</em> to have assembly with it, and SPAR hasn’t called yet. You’d also be thrown off right?</p>
<p>So we basically just had to put in additional logic on the <strong>initial</strong> event that a customer with multiple assembly legs has their first order fulfilled to email <a href="https://www.linkedin.com/in/will-jaroszewicz-27313466/">Will</a> and <a href="https://www.linkedin.com/in/nicholas-jaroszewicz/">Nick</a> and just say, “We haven’t posted to SPAR yet, but the first leg got fulfilled, let’s reach out to the customer to inform them what’s going on”.</p>
<p>And <strong>yes</strong>, this <strong>does</strong> seem like an automated task (for all the constructive critics) <strong>BUT!!</strong> the obvious caveat:</p>
<blockquote><p>What would Porvata be without the added benefit of getting to interact with Will and Nick?!</p></blockquote>
<h4 id="cancellations">Cancellations</h4>
<blockquote><p>A customer decided to cancel their order after getting an Assembly SKU fulfilled. We’ve already posted to SPAR. What do we do?</p></blockquote>
<p>This was <em>maybe</em> a nice to have, maybe a <a href="https://www.businessinsider.com/google-doubleclick-p0-failure-2014-11">P0</a> (as everyone says at <a href="https://www.google.com/finance/quote/DBX:NASDAQ">DBX</a> / in tech; also that P0 link has some good content).</p>
<p>SPAR wanted us to handle cancellations where SPAR assembly was an associated SKU and then post a reason to a different cancellation endpoint.</p>
<p>This wasn’t too bad just basically required some extra validation in terms of checking the <code class="language-plaintext highlighter-rouge">reason</code> of the <code class="language-plaintext highlighter-rouge">OrderCancellation</code> event for some keywords specified by Will as well as matching on the assembly SKU.</p>
<p>Here’s a demo of that:</p>
<p>https://capture.dropbox.com/JCyXdxLMnzPGDywN</p>
<p align="center"> <iframe src="https://capture.dropbox.com/JCyXdxLMnzPGDywN?raw=1" width="560" height="315" frameborder="0" allowfullscreen=""> </iframe></p>
<h2 id="extras-and-nice-to-haves">Extras and Nice-to-Haves</h2>
<p>These were some of the things that became apparent we need.</p>
<h3 id="email-notifications">Email Notifications</h3>
<p>I would borderline say this is a <code class="language-plaintext highlighter-rouge">P0</code> given we need insight into when we actually upload information. As a result, on key events, we’re emailing either myself, or <a href="https://porvata.com/">Porvata</a> depending on the event. Check out some examples below. Note, these are just emails, so I’m sending over enough to validate the order but nothing sensitive.</p>
<h4 id="order-received-event">Order Received Event</h4>
<p><img src="/images/porvata-dev/email-examples/order-received.png" alt="order-recieved-event"></p>
<h4 id="unknown-error-event">Unknown Error Event</h4>
<p><img src="/images/porvata-dev/email-examples/unknown-error.png" alt="unknown-error"></p>
<h4 id="outside-zip-code-event">Outside Zip Code Event</h4>
<p><img src="/images/porvata-dev/email-examples/outside-zip-code.png" alt="outside-zip-code"></p>
<h4 id="partial-order-fulfillment-event">Partial Order Fulfillment Event</h4>
<p>Yes I know I spelled <code class="language-plaintext highlighter-rouge">fulfillment</code> wrong <img class="emoji" title=":expressionless:" alt=":expressionless:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f611.png" height="20" width="20"></p>
<p><img src="/images/porvata-dev/email-examples/partial-order-fulfillment.png" alt="partial-order-fulfillment"></p>
<h4 id="full-order-fulfillment-event">Full Order Fulfillment Event</h4>
<p><img src="/images/porvata-dev/email-examples/success.png" alt="success"></p>
<h3 id="additional-service-checking">Additional Service Checking</h3>
<p>I wanted confirmation that the Porvata/SPAR integration service was up daily. <a href="https://porvata.com/">Porvata</a> is crushing so I basically get <code class="language-plaintext highlighter-rouge">OrderEvent</code>s coming through at a good cadence to confirm that the service is still working, however… I still wanted this as a double check. The code is small enough that I figured I could just post it below:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"""Send an email alert if the desired process cannot be found."""</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">psutil</span>

<span class="c1"># imports for GMAIL 
</span>
<span class="kn">from</span> <span class="nn">utils.email_sender</span> <span class="kn">import</span> <span class="n">EmailSender</span>

<span class="k">class</span> <span class="nc">ProcessSearcher</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">GMAIL_SENDER_ADDRESS</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"GMAIL_SENDER_ADDRESS is empty"</span>
        <span class="k">assert</span> <span class="n">GMAIL_SENDER_PASSWORD</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"GMAIL_SENDER_PASSWORD is empty"</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_email_sender</span> <span class="o">=</span> <span class="n">EmailSender</span><span class="p">(</span><span class="n">GMAIL_SENDER_ADDRESS</span><span class="p">,</span> <span class="n">GMAIL_SENDER_PASSWORD</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_process_by_name_and_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">is_found</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="n">psutil</span><span class="p">.</span><span class="n">process_iter</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pinfo</span> <span class="o">=</span> <span class="n">proc</span><span class="p">.</span><span class="n">as_dict</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s">"pid"</span><span class="p">,</span> <span class="s">"name"</span><span class="p">,</span> <span class="s">"create_time"</span><span class="p">,</span> <span class="s">"cmdline"</span><span class="p">])</span>
                <span class="c1"># We only want to look at python processes
</span>                <span class="k">if</span> <span class="s">"python"</span> <span class="ow">in</span> <span class="n">pinfo</span><span class="p">[</span><span class="s">"name"</span><span class="p">].</span><span class="n">lower</span><span class="p">():</span>
                    <span class="c1"># We want to look for the specific application executing and make
</span>                    <span class="c1"># sure that it's still up
</span>                    <span class="n">cmd</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">pinfo</span><span class="p">[</span><span class="s">"cmdline"</span><span class="p">]</span>
                    <span class="n">executing_cmd</span> <span class="o">=</span> <span class="s">" "</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">target_name</span> <span class="ow">in</span> <span class="n">executing_cmd</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span>
                            <span class="s">"Found target name in executing command. Sending information."</span>
                        <span class="p">)</span>
                        <span class="n">is_found</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">except</span> <span class="p">(</span><span class="n">psutil</span><span class="p">.</span><span class="n">NoSuchProcess</span><span class="p">,</span> <span class="n">psutil</span><span class="p">.</span><span class="n">AccessDenied</span><span class="p">,</span> <span class="n">psutil</span><span class="p">.</span><span class="n">ZombieProcess</span><span class="p">):</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_found</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s">"Scanned through all running processes and did not find </span><span class="si">{</span><span class="n">target_name</span><span class="si">}</span><span class="s">"</span>
            <span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Sending porvata.dev@gmail.com an alert."</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_email_sender</span><span class="p">.</span><span class="n">send_email_htmltext</span><span class="p">(</span>
                <span class="s">"porvata.dev@gmail.com"</span><span class="p">,</span>
                <span class="sa">f</span><span class="s">"🆘⚠️ Did not find </span><span class="si">{</span><span class="n">target_name</span><span class="si">}</span><span class="s"> process running. ⚠️🆘"</span><span class="p">,</span>
                <span class="s">"Please check the EC2 instance and restart service if need be."</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_email_sender</span><span class="p">.</span><span class="n">send_email_htmltext</span><span class="p">(</span>
                <span class="s">"porvata.dev@gmail.com"</span><span class="p">,</span>
                <span class="sa">f</span><span class="s">"✅🚀 Service </span><span class="si">{</span><span class="n">target_name</span><span class="si">}</span><span class="s"> is up and running. 🚀✅"</span><span class="p">,</span>
                <span class="s">"All good!! Keep juicing."</span><span class="p">,</span>
            <span class="p">)</span>

</code></pre></div></div>
<p>I basically just set up a cronjob to run this bit of code. At first, it was every hour, then every four hours, now every 8 hours, soon to be once a day.</p>
<p>And here’s the resulting email:</p>
<p><img src="/images/porvata-dev/email-examples/service-check.png" alt="service-check"></p>
<h3 id="logging">Logging</h3>
<p>This is obviously important for debugging and understanding what has happened to a customer order. As you can see from the screenshot above, I have a decent logging system setup, predicated on the python <code class="language-plaintext highlighter-rouge">logging</code> module.</p>
<p>And once again, I know you guys are thinking… dang, well you might as well have set up a <code class="language-plaintext highlighter-rouge">mysql</code> or <code class="language-plaintext highlighter-rouge">sqllite</code> database just for easier searching with logs and events. And yeah, maybe that’s true, but Shopify is so queryable and easy to integrate with that I haven’t really found the need. Note, I excluded <code class="language-plaintext highlighter-rouge">postgres</code> from the suggestions of DBs because I am not too familiar with it, and also because I’ve heard it can be memory intensive. Given that there’s already a solid amount of work being performed on my tiny EC2 instance, I don’t think inundating it with more processes would be ideal. And if you’re asking why not use <a href="https://aws.amazon.com/rds/">Amazon RDS</a>, because 1) I didn’t want to pay more 2) I didn’t want to go through that additional setup. Once <a href="https://porvata.com/">Porvata</a> becomes a unicorn, I’ll scale this service in like ten different areas.</p>
<h3 id="linting-and-githooks">Linting and GitHooks</h3>
<p>I’ve already learned a good amount from Dropbox but I wanted to have it so whenever I pushed up a commit, it would automatically run <code class="language-plaintext highlighter-rouge">black</code> and <code class="language-plaintext highlighter-rouge">pylint</code> the code as well as run the <code class="language-plaintext highlighter-rouge">mypy</code> validation. Type hints are an absolute life saver at Dropbox and similarly, they were with this project as well. <a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks">Here’s the documentation</a> I’d use for commit hooks if you’re interested in setting those up for your project.</p>
<h1 id="conclusion">Conclusion</h1>
<p>Again, this was probably one of my favorite things to work on. Learned a ton and got to work with a best friend so it doesn’t really get much better than that.</p>
<p>This ended up touching a lot of new frameworks and packages that I hadn’t really used before. Here’s a summary below:</p>
<ul>
<li>Infrastructure<ul>
<li>
<a href="https://aws.amazon.com/pm/ec2/">EC2</a><ul>
<li>I had used this before, but definitely got a bit more familiar throughout this project</li>
<li>Elastic IPs</li>
</ul>
</li>
<li>
<a href="https://cloud.google.com/pubsub">Google Pub/Sub Notifications</a><ul>
<li>Historical events saved for 10 days</li>
<li>Replaying events if issues</li>
</ul>
</li>
<li><a href="https://developers.google.com/gmail/api/quickstart/python">Gmail email automation</a></li>
<li><a href="https://ngrok.com/product">ngrok</a></li>
<li>
<a href="https://crontab.guru/">cronjob</a>s</li>
<li>
<a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks">GitHub commit hooks</a><ul>
<li>
<a href="https://black.readthedocs.io/en/stable/">black</a> formatting</li>
<li>
<a href="http://mypy-lang.org/">mypy</a> validation</li>
<li>
<a href="https://pylint.pycqa.org/en/latest/">pylint</a> linting</li>
</ul>
</li>
</ul>
</li>
<li>Software<ul>
<li><a href="https://flask.palletsprojects.com/en/2.0.x/">Flask</a></li>
<li><a href="https://shopify.dev/api">Shopify API</a></li>
<li><a href="https://graphql.org/">GraphQL</a></li>
<li>
<a href="https://www.tutorialspoint.com/python/python_multithreading.htm">Multithreading</a><ul>
<li>Again, had some exposure through work, but this expanded</li>
<li>Better utilization of Python <code class="language-plaintext highlighter-rouge">logging</code> module</li>
</ul>
</li>
<li>Process checking for service checks</li>
</ul>
</li>
</ul>
<p>And as for clear business results…</p>
<ul>
<li>Order placed with SPAR information<ul><li>Email notification sent</li></ul>
</li>
<li>Order placed without SPAR information<ul><li>Different email notification sent</li></ul>
</li>
<li>Order fulfilled with SPAR information<ul><li>Both Will and Nick notified, as well as the appropriate information uploaded to SPAR</li></ul>
</li>
<li>Order fulfilled with SPAR information, but placed outside of the zip code<ul><li>Email placed with corresponding zip code and Will and Nick alerted</li></ul>
</li>
<li>Order fulfilled with multiple SPAR legs<ul><li>First time one of the legs is fulfilled, Will and Nick alerted (with action item to reach out to the customer to confirm SPAR will call once all legs fulfilled)</li></ul>
</li>
<li>Error state<ul><li>Alert email sent out</li></ul>
</li>
</ul>
<p>Let me know if any questions / suggestions! Thanks for reading! I know this one was a long one.</p></article><div class="post-content controls__inner">
<div class="controls__item prev"> <span>Previous</span> <a href="/2022/blog-revamp/"> <span> <svg xmlns="http://www.w3.org/2000/svg" width="6" height="11"><path fill="fillColor" d="M5.647 1.718c.37-.434.323-1.09-.106-1.465A1.016 1.016 0 0 0 4.095.36L.25 4.875a1.05 1.05 0 0 0 .017 1.378l3.95 4.407c.38.424 1.03.456 1.448.07a1.05 1.05 0 0 0 .07-1.468l-3.34-3.725 3.253-3.819z"></path> </svg> </span> The Blog Reborn </a>
</div>
<div class="controls__item next"></div>
</div>
</div>
<div class="comments"><div class="container"><div class="post-content">
<div id="disqus_thread"></div>
<script> var disqus_config = function () { this.page.url = 'http://localhost:4000/2022/porvata-dev/'; this.page.identifier = 'http://localhost:4000/2022/porvata-dev/'; }; (function() { var d = document, s = d.createElement('script'); s.src = 'https://jlarks32.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the comments.</noscript>
</div></div></div></main><footer class="footer"><div class="container">
<nav class="social"> <a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/johnlarkin1"> <svg class="social__icon" viewbox="0 0 20 20" width="20px" height="20px"><path d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path></svg> </a></nav><span>© 2022 Where will you go next?. All rights reserved.</span>
</div></footer><script async src="/assets/js/bundle.js"></script></body></html>
