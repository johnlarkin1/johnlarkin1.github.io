<!DOCTYPE html><html lang="en-US"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --><title>Into the Arena: Hierarchical Agglomerative Clustering | Where will you go next?</title><meta name="generator" content="Jekyll v3.9.2" /><meta property="og:title" content="Into the Arena: Hierarchical Agglomerative Clustering" /><meta name="author" content="johnlarkin1" /><meta property="og:locale" content="en_US" /><meta name="description" content="Table of Contents Table of Contents Motivation Introduction Abstract Thoughts Goal Problem Approach Part 1 - Fake Data üßë‚Äçüíª But how fake should that fake data be? Part 2 - Theory of Hierarchical Agglomerative Clustering üë®‚Äçüè´ What is Hierarchical Clustering? What is Agglomerative Clustering? What is Divisive Clustering? What is a linkage? What are the various linkage approaches? What is Precision? Definition What is Recall? Definition: What is a Confusion Matrix? What is an F1 Score? Part 3 - Algorithmic Approach üëæ How to compute distance? How to identify the new clusters center? Part 4 - Ground Up Implementation üë∑‚Äç‚ôÇÔ∏è Heart of the Implementation Questions that Arose Early Stopping Criterion Mapping Generated ClusterIds to Ground Truth Label Plotting a Dendrogram Part 5 - Polished Implementation üíÖ Takeways - how did we do?! Misses üéØ Performance Distance Function Wins üéâ Accuracy Beautiful Visualizations Deeper Understanding and New Technical Skills Next Steps ü™ú Dendrogram Visualization" /><meta property="og:description" content="Table of Contents Table of Contents Motivation Introduction Abstract Thoughts Goal Problem Approach Part 1 - Fake Data üßë‚Äçüíª But how fake should that fake data be? Part 2 - Theory of Hierarchical Agglomerative Clustering üë®‚Äçüè´ What is Hierarchical Clustering? What is Agglomerative Clustering? What is Divisive Clustering? What is a linkage? What are the various linkage approaches? What is Precision? Definition What is Recall? Definition: What is a Confusion Matrix? What is an F1 Score? Part 3 - Algorithmic Approach üëæ How to compute distance? How to identify the new clusters center? Part 4 - Ground Up Implementation üë∑‚Äç‚ôÇÔ∏è Heart of the Implementation Questions that Arose Early Stopping Criterion Mapping Generated ClusterIds to Ground Truth Label Plotting a Dendrogram Part 5 - Polished Implementation üíÖ Takeways - how did we do?! Misses üéØ Performance Distance Function Wins üéâ Accuracy Beautiful Visualizations Deeper Understanding and New Technical Skills Next Steps ü™ú Dendrogram Visualization" /><link rel="canonical" href="http://localhost:4000/2024/into-the-arena/" /><meta property="og:url" content="http://localhost:4000/2024/into-the-arena/" /><meta property="og:site_name" content="Where will you go next?" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-02-20T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Into the Arena: Hierarchical Agglomerative Clustering" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"johnlarkin1"},"dateModified":"2024-02-20T00:00:00-05:00","datePublished":"2024-02-20T00:00:00-05:00","description":"Table of Contents Table of Contents Motivation Introduction Abstract Thoughts Goal Problem Approach Part 1 - Fake Data üßë‚Äçüíª But how fake should that fake data be? Part 2 - Theory of Hierarchical Agglomerative Clustering üë®‚Äçüè´ What is Hierarchical Clustering? What is Agglomerative Clustering? What is Divisive Clustering? What is a linkage? What are the various linkage approaches? What is Precision? Definition What is Recall? Definition: What is a Confusion Matrix? What is an F1 Score? Part 3 - Algorithmic Approach üëæ How to compute distance? How to identify the new clusters center? Part 4 - Ground Up Implementation üë∑‚Äç‚ôÇÔ∏è Heart of the Implementation Questions that Arose Early Stopping Criterion Mapping Generated ClusterIds to Ground Truth Label Plotting a Dendrogram Part 5 - Polished Implementation üíÖ Takeways - how did we do?! Misses üéØ Performance Distance Function Wins üéâ Accuracy Beautiful Visualizations Deeper Understanding and New Technical Skills Next Steps ü™ú Dendrogram Visualization","headline":"Into the Arena: Hierarchical Agglomerative Clustering","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2024/into-the-arena/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/images/mountain.png"},"name":"johnlarkin1"},"url":"http://localhost:4000/2024/into-the-arena/"}</script> <!-- End Jekyll SEO tag --><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icons/apple-touch-icon.png?v=qA3OXqyw77"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/icons/favicon-32x32.png?v=qA3OXqyw77"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/icons/favicon-16x16.png?v=qA3OXqyw77"><link rel="manifest" href="/assets/img/icons/manifest.json?v=qA3OXqyw77"><link rel="mask-icon" href="/assets/img/icons/safari-pinned-tab.svg?v=qA3OXqyw77" color="#5bbad5"> <!--[if IE]><link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77"><![endif]--><link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77"><meta name="apple-mobile-web-app-title" content="Sleek"><meta name="application-name" content="Sleek"><meta name="msapplication-config" content="/assets/img/icons/browserconfig.xml?v=qA3OXqyw77"><meta name="theme-color" content="#ffffff"> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=GTM-KDHGNV6"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'GTM-KDHGNV6'); </script><style class="inlineCSS"> h1{color:#313237;margin-top:0;margin-bottom:.5rem}.dark-bg{background-color:#313237}@media only screen and (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:last-of-type,.post-card:nth-child(2n+2){margin-right:0}}html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figure,main{display:block}figure{margin:1em 40px}a{background-color:transparent;-webkit-text-decoration-skip:objects}img{border-style:none}svg:not(:root){overflow:hidden}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{-webkit-box-sizing:border-box;box-sizing:border-box}body{-webkit-overflow-scrolling:touch}*,::after,::before{-webkit-box-sizing:inherit;box-sizing:inherit}.site{display:-webkit-box;display:-ms-flexbox;display:flex;min-height:100vh;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.site__content{-webkit-box-flex:1;-ms-flex:1;flex:1}img{max-width:100%;height:auto;width:auto;vertical-align:middle}figure{margin:0}body{background-color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Hiragino Sans GB","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif;font-size:1rem;line-height:1.5;color:#343851;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%}p{margin-top:0;margin-bottom:1.25rem}h1,h2{color:#313237;margin-top:0;margin-bottom:.5rem}a{color:#277cea;text-decoration:none;border-bottom:1px dashed #277cea}.blur{background:#fff;filter:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg"><filter id="filter"><feGaussianBlur stdDeviation="16" /></filter></svg>#filter');-webkit-filter:blur(1rem);filter:blur(1rem)}.container{padding:0 20px;max-width:100%;margin:0 auto}@media only screen and (min-width:36em){.container{max-width:540px;margin:0 auto}}@media only screen and (min-width:48em){.container{max-width:720px;margin:0 auto}}@media only screen and (min-width:62em){.container{max-width:960px;margin:0 auto}}@media only screen and (min-width:75em){.container{max-width:1170px;margin:0 auto}}.header{background-color:#fff;color:#343851;position:absolute;z-index:4;width:100%;top:0;left:0;will-change:transform;-webkit-transform:translateY(0);transform:translateY(0)}.header a{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:0}.header__logo{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;overflow:hidden;padding:19px 0;margin-right:1.25rem;outline:0;border-bottom:0;color:#313237}.header__logo .header__logo--container{width:58px}.header__logo .header__logo--container .logo{fill:currentColor}.header__inner{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:3.75em;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.header__links{padding-bottom:.5rem;display:none;position:absolute;top:3.75em;left:0;width:100%;height:auto;background:#fff}.header__link{color:#343851;padding:.938rem 0;border-top:1px solid #ededed}.header__toggle{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:44px;height:100%;background-color:transparent;padding-left:1.25rem}.header__toggle span{display:block;position:relative;margin-top:4px;background-color:#343851;width:100%;height:2px;border-radius:1px}.header__toggle span:first-child{margin-top:0}@media (min-width:62em){.header__toggle{display:none;visibility:hidden}.header__links{position:static;padding:0;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;visibility:visible;width:auto;height:100%}.header__links-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;padding:0}.header__link{position:relative;padding:.938rem 1rem;border:0;height:100%}.header__link::after{content:"";display:block;position:absolute;left:0;bottom:0;height:3px;width:100%;-webkit-transform:scaleX(0);transform:scaleX(0);background:#277cea}}.post-card{display:block;position:relative;width:100%;min-height:250px;border-radius:4px;overflow:hidden;background-color:#fff;-webkit-box-shadow:0 1px 3px rgba(0,0,0,.08);box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:2.25rem;border-bottom:0}@media only screen and (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:0}}@media only screen and (min-width:75em){.post-card{width:31.25%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:3.125%}}.post-card__label{position:absolute;top:1.5rem;left:1.5rem;z-index:2}.post-card__inner{display:block;position:relative;padding:1.875rem 1.25rem .625rem;width:100%;color:#838c8d;border-bottom:0}.post-card__header{margin-bottom:.75rem}.post-card__meta{font-size:.875rem}.post-card__thumb{margin:0;background:#fff;position:relative;overflow:hidden}.post-card__thumb::after{content:"";display:block;height:0;width:100%;padding-bottom:56.25%}.post-card__thumb>*{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.label{padding:0 10px;margin-bottom:1rem;display:inline-block;line-height:20px;font-size:.75rem;text-transform:uppercase;letter-spacing:1px;color:rgba(255,255,255,.8);border:2px solid rgba(255,255,255,.5);border-radius:100px}.hero{margin:3.75rem auto 0;min-height:16.25rem;width:100%;position:relative;background-color:#dde5ea;background-repeat:no-repeat;background-position:50%;background-size:cover}@media only screen and (min-width:62em){.hero{margin:0 auto;height:36em}}.hero::before{position:absolute;display:block;content:"";top:0;left:0;width:100%;height:100%;background:rgba(52,56,81,.8)}.hero__wrap{position:absolute;margin:auto;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);text-align:center;color:rgba(255,255,255,.8);width:100%;max-width:90%;z-index:1}.hero__wrap .hero__title{font-size:1.8em;color:#fff}.blog{background-color:#f9f9f9}.post-list{padding-top:2.5em;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto}@media only screen and (min-width:48em){.hero__wrap{max-width:40em}.hero__wrap .hero__title{padding:1rem 0;font-size:2.625em;line-height:3.125rem}.post-list{padding-top:5em}}</style><link rel="preload" href="/assets/css/main.css" as="style" onload="this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="/assets/css/main.css"></noscript> <script type="text/javascript"> /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */ (function(w){"use strict";if(!w.loadCSS){w.loadCSS=function(){}} var rp=loadCSS.relpreload={};rp.support=(function(){var ret;try{ret=w.document.createElement("link").relList.supports("preload")}catch(e){ret=!1} return function(){return ret}})();rp.bindMediaToggle=function(link){var finalMedia=link.media||"all";function enableStylesheet(){link.media=finalMedia} if(link.addEventListener){link.addEventListener("load",enableStylesheet)}else if(link.attachEvent){link.attachEvent("onload",enableStylesheet)} setTimeout(function(){link.rel="stylesheet";link.media="only x"});setTimeout(enableStylesheet,3000)};rp.poly=function(){if(rp.support()){return} var links=w.document.getElementsByTagName("link");for(var i=0;i<links.length;i++){var link=links[i];if(link.rel==="preload"&&link.getAttribute("as")==="style"&&!link.getAttribute("data-loadcss")){link.setAttribute("data-loadcss",!0);rp.bindMediaToggle(link)}}};if(!rp.support()){rp.poly();var run=w.setInterval(rp.poly,500);if(w.addEventListener){w.addEventListener("load",function(){rp.poly();w.clearInterval(run)})}else if(w.attachEvent){w.attachEvent("onload",function(){rp.poly();w.clearInterval(run)})}} if(typeof exports!=="undefined"){exports.loadCSS=loadCSS} else{w.loadCSS=loadCSS}}(typeof global!=="undefined"?global:this)) </script></head><body class="site"> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KDHGNV6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) --><header class="header" itemscope itemtype="http://schema.org/SiteNavigationElement" aria-label="Main navigation"><div class="container"><div class="header__inner"> <a class="header__logo" href="/"><div class="header__logo--container"> <?xml version="1.0" encoding="utf-8"?> <svg viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg"> <g transform="matrix(0.1, 0, 0, -0.1, 15.002323, 500.303864)" fill="#000000" stroke="none"> <g transform="matrix(1, 0, 0, 1, 64.297943, -253.624268)"><path d="M 1148.351 4440.762 C 980.351 4426.762 838.351 4381.762 683.351 4293.762 C 579.351 4233.762 500.351 4171.762 405.351 4070.762 C 245.351 3903.762 123.351 3657.762 87.351 3430.762 C 71.351 3325.762 81.351 3069.762 107.351 2960.762 C 190.351 2598.762 441.351 2280.762 762.351 2129.762 C 916.351 2057.762 1064.351 2029.762 1277.351 2030.762 C 1446.351 2030.762 1595.351 2064.762 1756.351 2136.762 C 1909.351 2206.762 2089.351 2360.762 2263.351 2570.762 C 2306.351 2622.762 2447.351 2788.762 2577.351 2938.762 C 2707.351 3088.762 2846.351 3250.762 2886.351 3298.762 C 2986.351 3416.762 3084.351 3515.762 3138.351 3551.762 C 3329.351 3678.762 3580.351 3618.762 3689.351 3418.762 C 3722.351 3358.762 3723.351 3351.762 3723.351 3250.762 C 3723.351 3157.762 3720.351 3138.762 3696.351 3088.762 C 3661.351 3012.762 3589.351 2937.762 3519.351 2903.762 C 3469.351 2878.762 3452.351 2875.762 3363.351 2875.762 C 3293.351 2875.762 3247.351 2881.762 3211.351 2894.762 C 3145.351 2916.762 3031.351 2990.762 2953.351 3061.762 C 2838.351 3165.762 2854.351 3160.762 2809.351 3108.762 C 2787.351 3083.762 2748.351 3037.762 2722.351 3006.762 L 2676.351 2949.762 L 2699.351 2923.762 C 2842.351 2767.762 3041.351 2633.762 3178.351 2599.762 C 3209.351 2592.762 3286.351 2585.762 3353.351 2585.762 C 3491.351 2585.762 3577.351 2606.762 3688.351 2667.762 C 3785.351 2721.762 3893.351 2835.762 3946.351 2940.762 C 4003.351 3053.762 4021.351 3145.762 4015.351 3280.762 C 3998.351 3622.762 3740.351 3884.762 3398.351 3907.762 C 3197.351 3920.762 3000.351 3835.762 2837.351 3664.762 C 2779.351 3602.762 2482.351 3264.762 2383.351 3145.762 C 2351.351 3107.762 2321.351 3073.762 2318.351 3070.762 C 2315.351 3067.762 2246.351 2987.762 2164.351 2892.762 C 1904.351 2589.762 1814.351 2509.762 1643.351 2429.762 C 1401.351 2316.762 1106.351 2313.762 883.351 2422.762 C 847.351 2439.762 779.351 2483.762 731.351 2520.762 C 506.351 2690.762 384.351 2943.762 383.351 3235.762 C 383.351 3461.762 451.351 3655.762 589.351 3820.762 C 690.351 3942.762 856.351 4055.762 1008.351 4106.762 C 1086.351 4132.762 1393.351 4133.762 1486.351 4108.762 C 1593.351 4078.762 1696.351 4030.762 1803.351 3960.762 C 1927.351 3878.762 1938.351 3874.762 1983.351 3896.762 C 2030.351 3918.762 2106.351 4006.762 2114.351 4046.762 C 2125.351 4104.762 2105.351 4126.762 1963.351 4222.762 C 1782.351 4343.762 1629.351 4403.762 1418.351 4435.762 C 1315.351 4451.762 1292.351 4451.762 1148.351 4440.762 Z"/><path d="M 3158.351 4434.762 C 2991.351 4404.762 2823.351 4337.762 2689.351 4247.762 C 2568.351 4166.762 2426.351 4021.762 2173.351 3720.762 C 1901.351 3397.762 1583.351 3043.762 1507.351 2980.762 C 1409.351 2898.762 1335.351 2870.762 1217.351 2870.762 C 1059.351 2870.762 941.351 2944.762 877.351 3085.762 C 858.351 3126.762 854.351 3153.762 854.351 3235.762 C 853.351 3327.762 856.351 3341.762 885.351 3402.762 C 947.351 3534.762 1052.351 3606.762 1198.351 3617.762 C 1351.351 3629.762 1483.351 3563.762 1674.351 3378.762 L 1735.351 3319.762 L 1805.351 3392.762 C 1844.351 3432.762 1888.351 3479.762 1902.351 3497.762 L 1928.351 3528.762 L 1836.351 3615.762 C 1722.351 3722.762 1628.351 3790.762 1523.351 3841.762 C 1189.351 4003.762 788.351 3866.762 628.351 3535.762 C 501.351 3272.762 549.351 2979.762 753.351 2775.762 C 876.351 2651.762 999.351 2595.762 1173.351 2583.762 C 1332.351 2573.762 1502.351 2623.762 1629.351 2718.762 C 1713.351 2780.762 1925.351 3007.762 2248.351 3380.762 C 2330.351 3475.762 2469.351 3631.762 2524.351 3690.762 C 2547.351 3715.762 2594.351 3766.762 2629.351 3803.762 C 2710.351 3891.762 2820.351 3974.762 2933.351 4032.762 C 3077.351 4106.762 3140.351 4122.762 3310.351 4127.762 C 3446.351 4132.762 3462.351 4131.762 3549.351 4106.762 C 3832.351 4024.762 4059.351 3804.762 4157.351 3514.762 C 4215.351 3340.762 4211.351 3139.762 4145.351 2943.762 C 4100.351 2808.762 4035.351 2705.762 3924.351 2595.762 C 3734.351 2407.762 3523.351 2326.762 3265.351 2345.762 C 3055.351 2359.762 2913.351 2407.762 2739.351 2521.762 C 2631.351 2593.762 2600.351 2588.762 2514.351 2483.762 C 2483.351 2446.762 2468.351 2418.762 2468.351 2399.762 C 2468.351 2312.762 2744.351 2135.762 2972.351 2075.762 C 3111.351 2038.762 3113.351 2038.762 3275.351 2033.762 C 3603.351 2022.762 3851.351 2106.762 4084.351 2308.762 C 4329.351 2519.762 4483.351 2840.762 4505.351 3184.762 C 4511.351 3295.762 4500.351 3402.762 4466.351 3540.762 C 4371.351 3934.762 4066.351 4263.762 3676.351 4394.762 C 3523.351 4446.762 3312.351 4462.762 3158.351 4434.762 Z"/> </g> <g transform="matrix(1, 0, 0, 1, 23.988497, -200.499054)"><path d="M305 1726 c-15 -22 -11 -34 59 -222 41 -109 84 -230 97 -268 26 -75 52 -101 92 -91 29 8 35 19 98 187 24 65 46 118 49 118 3 0 29 -60 59 -133 29 -72 60 -142 67 -154 17 -28 55 -30 77 -5 22 24 207 513 207 547 0 39 -67 59 -104 32 -10 -8 -44 -89 -80 -195 l-62 -182 -54 132 c-60 143 -81 178 -110 178 -26 0 -39 -22 -100 -172 -29 -71 -54 -128 -55 -128 -2 0 -17 39 -34 88 -70 195 -103 273 -121 282 -32 17 -69 12 -85 -14z"/><path d="M1380 1730 c-19 -19 -20 -33 -20 -281 0 -150 4 -268 10 -279 13 -24 53 -33 84 -19 25 12 25 15 28 123 l3 111 138 3 137 3 0 -106 c0 -92 3 -108 20 -125 24 -24 48 -25 78 -4 22 15 22 17 22 289 0 272 0 274 -22 289 -30 21 -61 20 -81 -2 -14 -15 -17 -40 -17 -126 l0 -107 -137 3 -138 3 -2 108 c-1 92 -4 111 -20 122 -26 20 -60 18 -83 -5z"/><path d="M2235 1738 c-11 -6 -23 -16 -27 -22 -4 -6 -8 -128 -8 -272 0 -240 1 -262 18 -277 16 -15 46 -17 205 -17 185 0 187 0 202 24 16 25 12 49 -13 79 -13 15 -34 17 -154 17 l-138 0 0 48 c0 26 5 53 12 60 8 8 48 12 114 12 112 0 128 7 122 57 -4 40 -38 53 -145 53 l-93 0 0 60 0 60 130 0 c126 0 132 1 155 25 32 31 32 58 -1 84 -25 19 -40 21 -193 21 -105 0 -173 -5 -186 -12z"/><path d="M3759 1732 c-18 -12 -19 -31 -19 -281 0 -215 3 -271 14 -287 14 -18 26 -19 208 -16 133 3 195 7 200 15 4 7 8 26 8 44 0 54 -25 63 -177 63 l-133 0 0 54 c0 40 4 55 16 60 9 3 58 6 109 6 102 0 125 10 125 54 0 38 -20 45 -136 48 l-109 3 -3 34 c-2 19 -1 48 2 65 l6 31 136 2 c84 2 142 7 150 14 17 14 18 73 2 87 -21 16 -376 20 -399 4z"/><path d="M2953 1734 c-10 -4 -13 -72 -13 -289 0 -271 1 -285 19 -295 30 -16 59 -12 81 10 16 16 20 33 20 90 l0 70 48 0 47 -1 63 -84 62 -85 56 0 c38 0 56 4 60 14 3 8 -20 50 -50 94 -31 44 -56 83 -56 87 0 4 20 25 44 46 83 74 95 164 33 256 -52 76 -86 88 -257 90 -80 1 -151 0 -157 -3z m301 -143 c32 -30 34 -78 5 -115 -19 -25 -25 -26 -110 -26 l-89 0 0 86 0 86 84 -3 c73 -4 88 -7 110 -28z"/> </g> <g transform="matrix(1.18593, 0, 0, 1.18593, -376.416016, -436.098602)" style=""><path d="M 1802.803 958.916 C 1766.803 954.916 1718.803 905.916 1712.803 867.916 C 1705.803 821.916 1725.803 774.916 1763.803 749.916 C 1842.803 696.916 1944.803 748.916 1944.803 841.916 C 1944.803 922.916 1887.803 968.916 1802.803 958.916 Z M 1883.803 900.916 C 1938.803 830.916 1876.803 738.916 1798.803 771.916 C 1764.803 785.916 1754.803 802.916 1754.803 849.916 C 1754.803 919.916 1841.803 954.916 1883.803 900.916 Z"/><path d="M 2392.803 958.916 C 2356.803 954.916 2308.803 905.916 2302.803 867.916 C 2295.803 820.916 2315.803 774.916 2354.803 748.916 C 2383.803 728.916 2397.803 725.916 2438.803 730.916 C 2505.803 737.916 2516.803 749.916 2512.803 810.916 L 2509.803 861.916 L 2469.803 861.916 C 2439.803 861.916 2428.803 857.916 2426.803 844.916 C 2423.803 830.916 2429.803 826.916 2449.803 826.916 C 2472.803 826.916 2475.803 822.916 2472.803 799.916 C 2468.803 767.916 2434.803 754.916 2391.803 769.916 C 2358.803 780.916 2344.803 803.916 2344.803 849.916 C 2344.803 908.916 2409.803 945.916 2464.803 916.916 C 2486.803 904.916 2514.803 929.916 2493.803 941.916 C 2475.803 953.916 2421.803 962.916 2392.803 958.916 Z"/><path d="M 2642.803 958.916 C 2568.803 949.916 2527.803 846.916 2570.803 778.916 C 2628.803 688.916 2784.803 731.916 2784.803 838.916 C 2784.803 922.916 2729.803 969.916 2642.803 958.916 Z M 2723.803 900.916 C 2778.803 830.916 2716.803 738.916 2638.803 771.916 C 2604.803 785.916 2594.803 802.916 2594.803 849.916 C 2594.803 919.916 2681.803 954.916 2723.803 900.916 Z"/><path d="M 3806.803 950.916 C 3785.803 942.916 3774.803 930.916 3774.803 916.916 C 3774.803 892.916 3791.803 890.916 3815.803 912.916 C 3836.803 931.916 3864.803 924.916 3864.803 900.916 C 3864.803 891.916 3853.803 870.916 3839.803 854.916 C 3825.803 837.916 3815.803 818.916 3817.803 812.916 C 3822.803 797.916 3854.803 792.916 3854.803 806.916 C 3854.803 813.916 3865.803 831.916 3879.803 848.916 C 3918.803 894.916 3911.803 936.916 3863.803 954.916 C 3846.803 961.916 3829.803 960.916 3806.803 950.916 Z"/><path d="M 675.803 939.916 C 675.803 929.916 687.803 881.916 702.803 831.916 C 724.803 759.916 733.803 740.916 750.803 738.916 C 767.803 736.916 773.803 746.916 793.803 816.916 C 806.803 860.916 819.803 894.916 823.803 891.916 C 826.803 887.916 838.803 852.916 850.803 813.916 C 867.803 756.916 875.803 740.916 892.803 738.916 C 910.803 735.916 916.803 745.916 934.803 808.916 C 946.803 848.916 959.803 894.916 965.803 910.916 C 978.803 950.916 977.803 956.916 955.803 956.916 C 940.803 956.916 933.803 942.916 919.803 886.916 C 910.803 847.916 898.803 814.916 894.803 811.916 C 890.803 809.916 877.803 840.916 864.803 882.916 C 845.803 946.916 839.803 957.916 822.803 954.916 C 806.803 952.916 797.803 935.916 782.803 886.916 C 771.803 850.916 759.803 817.916 755.803 813.916 C 750.803 809.916 739.803 838.916 728.803 878.916 C 714.803 930.916 704.803 952.916 692.803 954.916 C 680.803 956.916 674.803 951.916 675.803 939.916 Z"/><path d="M 1004.803 846.916 C 1004.803 755.916 1007.803 736.916 1019.803 736.916 C 1031.803 736.916 1034.803 755.916 1034.803 846.916 C 1034.803 937.916 1031.803 956.916 1019.803 956.916 C 1007.803 956.916 1004.803 937.916 1004.803 846.916 Z"/><path d="M 1094.803 847.916 L 1094.803 736.916 L 1159.803 736.916 C 1210.803 736.916 1224.803 739.916 1224.803 751.916 C 1224.803 762.916 1212.803 766.916 1179.803 766.916 L 1135.803 766.916 L 1132.803 858.916 C 1129.803 937.916 1126.803 951.916 1112.803 954.916 C 1096.803 957.916 1094.803 947.916 1094.803 847.916 Z"/><path d="M 1254.803 846.916 L 1254.803 736.916 L 1324.803 736.916 C 1380.803 736.916 1394.803 739.916 1394.803 751.916 C 1394.803 762.916 1382.803 766.916 1344.803 766.916 L 1294.803 766.916 L 1294.803 861.916 C 1294.803 949.916 1293.803 956.916 1274.803 956.916 C 1255.803 956.916 1254.803 949.916 1254.803 846.916 Z"/><path d="M 1494.803 951.916 C 1494.803 949.916 1512.803 919.916 1534.803 885.916 C 1565.803 837.916 1574.803 813.916 1574.803 779.916 C 1574.803 743.916 1577.803 736.916 1594.803 736.916 C 1611.803 736.916 1614.803 743.916 1614.803 786.916 C 1614.803 827.916 1621.803 846.916 1649.803 889.916 C 1689.803 949.916 1691.803 956.916 1665.803 956.916 C 1652.803 956.916 1637.803 941.916 1623.803 916.916 C 1610.803 894.916 1597.803 876.916 1593.803 876.916 C 1590.803 876.916 1575.803 894.916 1560.803 916.916 C 1544.803 940.916 1526.803 956.916 1514.803 956.916 C 1503.803 956.916 1494.803 954.916 1494.803 951.916 Z"/><path d="M 1986.803 867.916 C 1988.803 798.916 1993.803 774.916 2008.803 758.916 C 2047.803 714.916 2130.803 722.916 2153.803 772.916 C 2159.803 786.916 2164.803 833.916 2164.803 876.916 C 2164.803 949.916 2162.803 956.916 2144.803 956.916 C 2126.803 956.916 2124.803 949.916 2124.803 873.916 C 2124.803 782.916 2116.803 766.916 2072.803 766.916 C 2034.803 766.916 2024.803 790.916 2024.803 880.916 C 2024.803 951.916 2022.803 956.916 2003.803 956.916 C 1983.803 956.916 1982.803 952.916 1986.803 867.916 Z"/><path d="M 2924.803 846.916 C 2924.803 743.916 2925.803 736.916 2944.803 736.916 C 2962.803 736.916 2964.803 743.916 2964.803 819.916 L 2965.803 901.916 L 3017.803 819.916 C 3061.803 748.916 3073.803 736.916 3097.803 736.916 L 3124.803 736.916 L 3124.803 846.916 C 3124.803 949.916 3123.803 956.916 3104.803 956.916 C 3087.803 956.916 3085.803 948.916 3082.803 874.916 L 3079.803 791.916 L 3027.803 874.916 C 2984.803 941.916 2970.803 956.916 2949.803 956.916 L 2924.803 956.916 L 2924.803 846.916 Z"/><path d="M 3174.803 846.916 L 3174.803 736.916 L 3255.803 736.916 C 3315.803 736.916 3335.803 739.916 3332.803 749.916 C 3329.803 756.916 3305.803 762.916 3271.803 764.916 C 3215.803 767.916 3214.803 768.916 3214.803 796.916 C 3214.803 825.916 3215.803 826.916 3264.803 826.916 C 3307.803 826.916 3314.803 829.916 3314.803 846.916 C 3314.803 863.916 3307.803 866.916 3264.803 866.916 C 3215.803 866.916 3214.803 867.916 3214.803 896.916 C 3214.803 926.916 3215.803 926.916 3269.803 926.916 C 3311.803 926.916 3324.803 929.916 3324.803 941.916 C 3324.803 953.916 3309.803 956.916 3249.803 956.916 L 3174.803 956.916 L 3174.803 846.916 Z"/><path d="M 3390.803 902.916 L 3426.803 847.916 L 3397.803 804.916 C 3351.803 737.916 3351.803 736.916 3374.803 736.916 C 3387.803 736.916 3404.803 751.916 3424.803 782.916 L 3453.803 828.916 L 3481.803 782.916 C 3501.803 749.916 3515.803 736.916 3532.803 736.916 C 3557.803 736.916 3557.803 736.916 3512.803 803.916 C 3497.803 826.916 3484.803 847.916 3484.803 850.916 C 3484.803 854.916 3498.803 875.916 3514.803 898.916 C 3549.803 946.916 3551.803 956.916 3524.803 956.916 C 3512.803 956.916 3496.803 941.916 3482.803 916.916 C 3469.803 894.916 3457.803 876.916 3454.803 876.916 C 3451.803 876.916 3439.803 894.916 3426.803 916.916 C 3409.803 946.916 3397.803 956.916 3379.803 956.916 L 3354.803 956.916 L 3390.803 902.916 Z"/><path d="M 3564.803 941.916 C 3564.803 931.916 3575.803 926.916 3599.803 926.916 L 3634.803 926.916 L 3634.803 831.916 C 3634.803 743.916 3636.803 736.916 3654.803 736.916 C 3672.803 736.916 3674.803 744.916 3676.803 829.916 L 3679.803 921.916 L 3712.803 924.916 C 3732.803 926.916 3744.803 933.916 3744.803 942.916 C 3744.803 953.916 3726.803 956.916 3654.803 956.916 C 3581.803 956.916 3564.803 953.916 3564.803 941.916 Z"/><path d="M 3821.803 769.916 C 3807.803 756.916 3815.803 736.916 3834.803 736.916 C 3847.803 736.916 3854.803 743.916 3854.803 756.916 C 3854.803 775.916 3834.803 783.916 3821.803 769.916 Z"/> </g> </g> </svg></div></a><nav class="header__links"><div class="container header__links-wrapper"> <a class="header__link" href="/" itemprop="url"> <span itemprop="name">Home</span> </a> <a class="header__link" href="/about" itemprop="url"> <span itemprop="name">About</span> </a> <a class="header__link" href="/categories" itemprop="url"> <span itemprop="name">Categories</span> </a> <a class="header__link" href="/contact" itemprop="url"> <span itemprop="name">Contact</span> </a></div></nav><div class="header__toggle"> <span></span> <span></span> <span></span></div></div></div></header><div class="hero lazyload" data-bg="http://localhost:4000/assets/gif/hierarch-agg-clustering.gif"><div class="hero__wrap"><div class="hero__categories"> <a class="label" href="/categories/#Algorithms">Algorithms</a> &nbsp; <a class="label" href="/categories/#Development">Development</a> &nbsp; <a class="label" href="/categories/#A.I.">A.I.</a> &nbsp; <a class="label" href="/categories/#M.L.">M.L.</a></div><h1 class="hero__title">Into the Arena: Hierarchical Agglomerative Clustering</h1><p class="hero__meta"> <span> <time>20 Feb 2024</time>&nbsp;&middot; </span> <span> 54 mins read </span></p></div></div><main class="site__content"><div class="container"><article class="post-content" itemprop="articleBody"><h1 id="table-of-contents">Table of Contents</h1><ul><li><a href="#table-of-contents">Table of Contents</a></li><li><a href="#motivation">Motivation</a></li><li><a href="#introduction">Introduction</a><ul><li><a href="#abstract-thoughts">Abstract Thoughts</a></li></ul></li><li><a href="#goal">Goal</a></li><li><a href="#problem">Problem</a></li><li><a href="#approach">Approach</a></li><li><a href="#part-1---fake-data-">Part 1 - Fake Data üßë‚Äçüíª</a><ul><li><a href="#but-how-fake-should-that-fake-data-be">But how fake should that fake data be?</a></li></ul></li><li><a href="#part-2---theory-of-hierarchical-agglomerative-clustering-">Part 2 - Theory of Hierarchical Agglomerative Clustering üë®‚Äçüè´</a><ul><li><a href="#what-is-hierarchical-clustering">What is Hierarchical Clustering?</a><ul><li><a href="#what-is-agglomerative-clustering">What is Agglomerative Clustering?</a></li><li><a href="#what-is-divisive-clustering">What is Divisive Clustering?</a></li><li><a href="#what-is-a-linkage">What is a linkage?</a></li><li><a href="#what-are-the-various-linkage-approaches">What are the various linkage approaches?</a></li><li><a href="#what-is-precision">What is Precision?</a><ul><li><a href="#definition">Definition</a></li></ul></li><li><a href="#what-is-recall">What is Recall?</a><ul><li><a href="#definition-1">Definition:</a></li></ul></li><li><a href="#what-is-a-confusion-matrix">What is a Confusion Matrix?</a></li><li><a href="#what-is-an-f1-score">What is an F1 Score?</a></li></ul></li></ul></li><li><a href="#part-3---algorithmic-approach-">Part 3 - Algorithmic Approach üëæ</a><ul><li><a href="#how-to-compute-distance">How to compute distance?</a></li><li><a href="#how-to-identify-the-new-clusters-center">How to identify the new clusters center?</a></li></ul></li><li><a href="#part-4---ground-up-implementation-Ô∏è">Part 4 - Ground Up Implementation üë∑‚Äç‚ôÇÔ∏è</a><ul><li><a href="#heart-of-the-implementation">Heart of the Implementation</a></li><li><a href="#questions-that-arose">Questions that Arose</a><ul><li><a href="#early-stopping-criterion">Early Stopping Criterion</a></li><li><a href="#mapping-generated-clusterids-to-ground-truth-label">Mapping Generated ClusterIds to Ground Truth Label</a></li><li><a href="#plotting-a-dendrogram">Plotting a Dendrogram</a></li></ul></li></ul></li><li><a href="#part-5---polished-implementation-">Part 5 - Polished Implementation üíÖ</a></li><li><a href="#takeways---how-did-we-do">Takeways - how did we do?!</a><ul><li><a href="#misses-">Misses üéØ</a><ul><li><a href="#performance">Performance</a></li><li><a href="#distance-function">Distance Function</a></li></ul></li><li><a href="#wins-">Wins üéâ</a><ul><li><a href="#accuracy">Accuracy</a></li><li><a href="#beautiful-visualizations">Beautiful Visualizations</a></li><li><a href="#deeper-understanding-and-new-technical-skills">Deeper Understanding and New Technical Skills</a></li></ul></li><li><a href="#next-steps-">Next Steps ü™ú</a></li><li><a href="#dendrogram-visualization">Dendrogram Visualization</a></li></ul></li></ul><h1 id="motivation">Motivation</h1><p>Curious how you can make such fun clustering graphs like this? Read on! Or skip to here look at the results: <a href="#takeways---how-did-we-do">Takeways - how did we do?!</a>.</p><p><img src="/images/hac/dendrogram_3rd_party_complex_complete_leven.png" alt="complete_third_party" class="center-image" /></p><h1 id="introduction">Introduction</h1><p>Recently, I decided to throw my hat into the interviewing <strong>arena</strong>. And with that, I got burned pretty bad for this role that I was a bit fixated with.</p><p>I have not interviewed much, and as a result, I prepped decently hard for this job interview process. While I did make it to the final day, and did well on the design and coding challenges, ultimately the company decided to pass on me given they felt they had ‚Äúgiven me too many prompts‚Äù. I am assuming that was related to my relatively slow start in the first coding interview, and perhaps some of the open endedness of the system design question. It‚Äôs fair feedback and it‚Äôs a fair point. I don‚Äôt know if I totally agree with it, but in reality, it doesn‚Äôt matter what I believe, because it‚Äôs what they decided.</p><p><img src="/images/hac/anikan-padme-meme.jpeg" alt="meme" class="center-shrink" /></p><p>Regardless, it hurt, but I have learned from the process and will be more aware of that in the future. And hopefully I‚Äôll be a stronger interviewee as well.</p><p>That‚Äôs only the most recent encounter I‚Äôve had, but I‚Äôve had a bit of a bad spell of things related to work. It‚Äôs been a rather frustrating time.</p><p>The events above are all related to the purpose of this blog post which is to take a breather, expand on a fun technical problem I saw, and clean up some code that I wanted to improve. There‚Äôs also been a boom in AI/ML related engineering, and given the links above, this problem connects those.</p><h2 id="abstract-thoughts">Abstract Thoughts</h2><p>Before jumping into the problem, I want to explain a bit more about the title and the image I picked for the thumbnail of this blog post. It‚Äôs two fold:</p><ol><li>It feels like a constant battle to correctly answer interview questions and nail system design questions</li><li>It is the constant question of: <strong><code class="language-plaintext highlighter-rouge">Are you not entertained?</code></strong></li></ol><p>I‚Äôll be the first to say it, I hate the interview process. I have given now hundreds of interviers to experienced candidates across big tech to juniors in college looking for their internships. It‚Äôs inheritely a terrible solution to a hard problem.</p><p>Here‚Äôs what I somewhat think comes across:</p><ul><li>Have you seen this interview question before?</li><li>Can you recall time complexity analysis from college?</li><li>Do you understand underlying data structures?</li><li>Do you at least somewhat know how to program?</li><li>Generally, how do you decompose problems?</li></ul><p>What I don‚Äôt think comes across:</p><ul><li>Will you care about your job?</li><li>Will you be a good teammate?</li><li>Are you going to work hard?</li></ul><p>To me, in terms of who I want to work with, these later points (that traditional software engineering totally misses) are just as, if not more, important than the first couple of points.</p><p>Anyway, rant over. Moving onto the fun technical stuff.</p><h1 id="goal">Goal</h1><p>Explore a fun problem, generate a cool <a href="https://en.wikipedia.org/wiki/Dendrogram">dendogram</a>, and learn something new.</p><h1 id="problem">Problem</h1><p>Here‚Äôs the gist of the problem:</p><blockquote><p>Construct a rudimentary Entity Resolution (ER) pipeline. It should resolve retailer entities found in the dataset. Identical retailer entities should be linked together through Hierarchical Agglomerative Clustering (HAC).</p><p>Build a pipeline containing these steps:</p><ol><li>Preprocess the data</li><li>Generate a ground truth for the dataset a. Use retailer_nm to programatically generate the ground truth b. Save to <code class="language-plaintext highlighter-rouge">ground_truth_label</code></li><li><p>Implement HAC from scratch</p><p>a. Use <code class="language-plaintext highlighter-rouge">retailer_nm_modified</code> in the least</p><p>b. Linking, scoring, thresholds, are left up to you.</p><p>c. Dont use third party libraries. No <code class="language-plaintext highlighter-rouge">scikit-learn</code></p><p>d. You are allowed to ues 3rd party libraries for calculating score.</p></li><li><p>Measure accuracy of solution.</p><p>a. Generate a confusion matrix to calculate precision and recall for each predicted ‚Äúclass‚Äù</p><p>b. Use <code class="language-plaintext highlighter-rouge">ground_truth_label</code></p></li><li>Persist data to pipeline_output.csv. Should contain: a. cluster_id b. ground_truth_label c. precision_for_cluster_id d. recall_for_cluster_id</li></ol><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat pipeline_output.csv

cluster_id,ground_truth_label,precision_for_cluster_id,recall_for_cluster_id,store_record_id,retailer_id,retailer_nm,store_id,store_address_1,store_address_2,store_city,store_state,store_zip_code,store_county,vpid,retailer_nm_modified

</code></pre></div></div></blockquote><p>I‚Äôm going to further simplify the problem a little bit more and just use the retailer_nm_modified.</p><h1 id="approach">Approach</h1><p>We‚Äôre going to break down our approach into a couple of parts. Firstly, we‚Äôll generate some fake data. Secondl, we‚Äôll cover the theory. Thirdly, we‚Äôll cover my thoughts from an algorithmic approach. Then, we‚Äôll cover a custom ground up implementation, and finally, we‚Äôll cover a solution using external packages.</p><h1 id="part-1---fake-data-">Part 1 - Fake Data üßë‚Äçüíª</h1><p>I‚Äôm going to further simplify the problem by excluding some of the location data.</p><p>The actual problem that I saw had store_address, zip, city, etc. My thought was we could use some geodist library or some type of logic about two stores probably won‚Äôt be in the zip code (just so they‚Äôre not cannabalizing each other). However, just to protect my own time, given I‚Äôm blogging amidst the million of other things I need to do, we‚Äôll focus on names.</p><p>So before, we even get to the algorithm, let‚Äôs generate some fake data.</p><div class="lds-container"><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div><p>Great, check out the script that did that <a href="https://github.com/johnlarkin1/hierarchical-agglomerative-clustering/blob/main/data_generator.py">here</a>, but voila:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ï≠‚îÄjohnlarkin@Larkin-Air hierarchical-agglomerative-clustering ‚Äπmain‚Ä∫
‚ï∞‚îÄ‚û§  head data.csv
store_record_id,retailer_id,retailer_nm,store_id,store_address_1,store_address_2,store_city,store_state,store_zip_code,store_county,vpid,retailer_nm_modified
1,533,Target,28,mcmheyxuzfovcql,autqtndfoyyecbj,tcdudtzhgx,IL,44501,County134,24973,Targethz
2,315,Trader Joes,15,ivfptxahtmubhmt,khhsyjynsibbqgk,gppmvugarh,FL,51787,County118,35522,Trader Joes95
3,419,Walgreens,52,jthinnvoqqcnipl,forpgfpudtzyigo,myrifsmupn,TX,30360,County75,55924,qqWalgreens
4,660,Walmart,94,zmnrqzbqgfnlimd,mywwxeacltlzfyy,cshuzhvsxk,TX,81614,County41,94793,W a lmxar tx
5,848,Walmart,73,xhqrqrxmfuttvdz,tjvjgxxbhjkqxtt,lawdheatds,NY,85199,County9,42378,Walmarten
6,912,Best Buy,88,sdhpkjqdppemjlt,yproqhwpvatfnun,xiviehoifx,CA,67606,County124,40660,Best Buyfdf
7,752,Whole Foods,13,srlimmrwrgoizok,hardglbudsvaeww,cxygpjwlrb,NY,40502,County101,34246,Whole Foodsyjjq
8,532,Best Buy,96,ovbtnnrksidiihv,kcnguzspqxhwufz,xtaiwjiqya,FL,54283,County70,65235,Best Buytk
9,934,Home Depot,66,krnmvrmbybauurn,sjtzzslqoutgyhj,vawjgxzacw,OH,13184,County44,24976,Ho mxe De p o t
</code></pre></div></div><p>You can see that the data is largely garbled, but I did put some focus on just scrambling the <code class="language-plaintext highlighter-rouge">retailer_nm_modified</code> column, given that‚Äôs going to be where I focus (for this example). That should be good enough for now, if we need to tweak it in the future, then we can change our data gen script.</p><h2 id="but-how-fake-should-that-fake-data-be">But how fake should that fake data be?</h2><p>You can skip to the end, but I actually have two types of data generation, easy and hard. This was some type of check (besides the confusion matrix) that we‚Äôre clustering the easy data well, and the hard data less well.</p><p>It‚Äôs basically a toggle into the degree of simulated dirty data that we are creating. Basically, it comes down to this:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Input
</span><span class="n">SHOULD_GENERATE_EASY</span> <span class="o">=</span> <span class="bp">False</span>


<span class="k">if</span> <span class="n">SHOULD_GENERATE_EASY</span><span class="p">:</span>
    <span class="n">NUMBER_OF_RECORDS</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">DEST_FILE</span> <span class="o">=</span> <span class="s">"data_easy.csv"</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">NUMBER_OF_RECORDS</span> <span class="o">=</span> <span class="mi">400</span>
    <span class="n">DEST_FILE</span> <span class="o">=</span> <span class="s">"data_complex.csv"</span>
</code></pre></div></div><p>and then for our generation of <code class="language-plaintext highlighter-rouge">retailer_nm_modified</code> field:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">modify_retailer_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="s">"""Slightly modify the retailer name to simulate dirty data."""</span>
    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">" "</span><span class="p">,</span> <span class="s">""</span><span class="p">),</span>  <span class="c1"># Remove spaces
</span>        <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="p">.</span><span class="n">lower</span><span class="p">(),</span>  <span class="c1"># Convert to lowercase
</span>        <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="p">.</span><span class="n">upper</span><span class="p">(),</span>  <span class="c1"># Convert to uppercase
</span>        <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s">" "</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">split</span><span class="p">()[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">split</span><span class="p">())</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]),</span>  <span class="c1"># Keep first part
</span>        <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">([</span><span class="n">c</span><span class="p">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">c</span><span class="p">.</span><span class="n">lower</span><span class="p">()])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">),</span>  <span class="c1"># Mixed capitalization
</span>        <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">99</span><span class="p">)),</span>  <span class="c1"># Add numbers at the end
</span>    <span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">SHOULD_GENERATE_EASY</span><span class="p">:</span>
        <span class="n">operations</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span>
                <span class="o">+</span> <span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">([</span><span class="s">" Inc"</span><span class="p">,</span> <span class="s">" LLC"</span><span class="p">,</span> <span class="s">" Corp"</span><span class="p">,</span> <span class="s">" Co"</span><span class="p">,</span> <span class="s">" Ltd"</span><span class="p">,</span> <span class="s">" Corp."</span><span class="p">]),</span>  <span class="c1"># Add suffix
</span>                <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">c</span> <span class="o">+</span> <span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">([</span><span class="s">"-"</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="s">" "</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span>
                <span class="p">),</span>  <span class="c1"># Extra or missing characters
</span>                <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">+</span> <span class="n">random_string</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>  <span class="c1"># Add random letters at the end
</span>                <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">typo_generator</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>  <span class="c1"># Introduce a typographical error
</span>                <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">abbreviation</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>  <span class="c1"># Use abbreviation
</span>            <span class="p">]</span>
        <span class="p">)</span>
    <span class="c1"># Apply a random modification operation to the name
</span>    <span class="n">modified_name</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="n">operations</span><span class="p">)(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">modified_name</span>
</code></pre></div></div><h1 id="part-2---theory-of-hierarchical-agglomerative-clustering-">Part 2 - Theory of Hierarchical Agglomerative Clustering üë®‚Äçüè´</h1><p>Ok so everyone‚Äôs favorite part - let‚Äôs get into the theory.</p><h2 id="what-is-hierarchical-clustering">What is Hierarchical Clustering?</h2><p>Clustering is the process of creating groups based on some characteristics. The final result is a set of clusters, where each cluster is distinct from one another in some meaningful way. Often, given that we‚Äôre focusing on <em>hierarchical</em> clustering, the output can be represented as a <a href="https://en.wikipedia.org/wiki/Dendrogram">dendogram</a>. We‚Äôll produce one by the end of today‚Äôs blog post.</p><p>Some important points about hierarchical clustering<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>:</p><ol><li>No need to specify the number of clusters. The algorithm takes care of finding the clusters at the appropriate interval.</li><li>Data can often by organized into a dendogram.</li></ol><p>Visually, here are two examples.</p><p><img src="/images/hac/hierarch-agg-clustering-demo.gif" alt="agg" class="center-shrink" /></p><p><img src="/images/hac/hierarch-agg-clustering-demo2.gif" alt="agg2" class="center-shrink" /></p><h3 id="what-is-agglomerative-clustering">What is Agglomerative Clustering?</h3><p>You can probably get a good idea of context from the <em>agglomerative</em> portion (<em>agglomerare</em> meaning to ‚Äúwind into a ball‚Äù, <em>ad</em> meaning ‚Äúto,‚Äù and glomerare, ‚Äúball of yarn.‚Äù)</p><p>This approach starts with all of the data points as individuals. So the approach is:</p><ol><li>Each data point is its own cluster</li><li>Each cluster is merged with the most similar cluster</li><li>Repeat until only a single cluster remains</li></ol><h3 id="what-is-divisive-clustering">What is Divisive Clustering?</h3><p>More or less, this is the opposite strategy as agglomerative. Here are all of the points start as a single cluster, and we break them down.</p><ol><li>All data points start as part of the same cluster</li><li>Recursively split each cluster into smaller subcluster based on dis-similarity</li></ol><p>Divisive clustering is much more of a ‚Äúdivide and conquer‚Äù type algorithm approach.</p><p>Visually, it looks like:</p><p><img src="/images/hac/hierarch-div-clustering-demo.gif" alt="agg2" class="center-shrink" /></p><p>And yes, that‚Äôs the same gif just basically done in reverse.</p><p>We‚Äôre going to focus on agglomerative clustering.</p><h3 id="what-is-a-linkage">What is a linkage?</h3><p>A <strong>linkage</strong> is the criterion used to determine the distance between clusters.</p><p>So you can imagine that you have two clusters, and the linkage is basically going to be how we identify the similarity between clusters.</p><h3 id="what-are-the-various-linkage-approaches">What are the various linkage approaches?</h3><p>There are probably more, but from my research, these seem like the leading contenders:</p><ul><li>Minimum Linkage / Single Linkage</li><li>Maximum Linkage / Complete Linkage</li><li>Average Linkage</li><li>Centroid Linkage</li><li>Ward‚Äôs Criterion (for euclidean distances)</li></ul><p>This slide is going to be a good illustration of the different approaches<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup>:</p><p><img src="/images/hac/linkage-types.jpg" alt="agg2" class="center" /></p><p>As of right now, I‚Äôll try to support multiple types of linkage types.</p><h3 id="what-is-precision">What is Precision?</h3><p><a href="https://en.wikipedia.org/wiki/Precision_and_recall">Precision</a> measures the accuracy of positive predictions. It is the ratio of correctly predicted positive observations to the total predicted positive observations.</p><h4 id="definition">Definition</h4>\[Precision = \frac{TP}{TP + FP}\]<p>where</p><ul><li>\(TP\) = True Positives</li><li>\(FP\) = False Positives</li></ul><h3 id="what-is-recall">What is Recall?</h3><p>Also called sensitivity, <a href="https://en.wikipedia.org/wiki/Precision_and_recall">recall</a> is the ability of a classifier to find all the positive samples. Ratio of correctly predicted positive observations to all of the observations in the class.</p><h4 id="definition-1">Definition:</h4>\[Recall = \frac{TP}{TP + FN}\]<p>where</p><ul><li>\(TP\) = True Positives</li><li>\(FN\) = False Negatives</li></ul><h3 id="what-is-a-confusion-matrix">What is a Confusion Matrix?</h3><p>This is relatively straight forward, and I‚Äôm utilizing <code class="language-plaintext highlighter-rouge">sklearn.metrics</code> ‚Äòs <code class="language-plaintext highlighter-rouge">confusion_matrix</code>.</p><p>My FAVORITE visual I saw while researching the confusion matrix was here:</p><p><img src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*7EYylA6XlXSGBCF77j_rOA.png" alt="confusion matrix" class="center-image" /></p><p>courtesy of here<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup>.</p><p>However, for more data points, the confusion matrix basically represents these values dispersed throughout.</p><p>From <a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.confusion_matrix.html">their documentation</a>,</p><blockquote><p>By definition a confusion matrix <em>C</em> is such that <em>C_{i, j}</em> is equal to the number of observations known to be in group <em>i</em> and predicted to be in group <em>j</em>.</p><p>Thus in binary classification, the count of true negatives is <em>C_{0,0}</em>, false negatives is <em>C_{1,0}</em> true positives is <em>C_{1,1}</em>, and false positives is <em>C_{0,1}</em>.</p></blockquote><h3 id="what-is-an-f1-score">What is an F1 Score?</h3><p>I wanted some way to compare results with a single number for the easy vs hard data that we generated, and how well we clustered. The metric I decided to use was the <a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.f1_score.html">weighted F1 score</a>.</p><p>This is a way to get a single numerical value that combines aspects of <a href="https://en.wikipedia.org/wiki/Precision_and_recall">recall and precision</a>.</p><h1 id="part-3---algorithmic-approach-">Part 3 - Algorithmic Approach üëæ</h1><p>So let‚Äôs dive into the fundamentals and a bit more of a technical breakdown about how this is going to work.</p><p>There is one main question that is abstracted by the algorithm:</p><ul><li>How do you identify the ‚Äúdistance‚Äù between clusters?</li><li>How do you identify the new clusters center, so that you can then compare other clusters to that updated one?</li></ul><h2 id="how-to-compute-distance">How to compute distance?</h2><p>Here is where we have a lot of different approaches and it kind of depends on the actual data at hand. For example, we have basically geolocation data and somewhat distorted retailer names.</p><p>There‚Äôs a lot of different approaches we could take here, but when given the actual assignment, I harkened back to my bioinformatics classes. There were two that I remembered:</p><ul><li><a href="https://en.wikipedia.org/wiki/Hamming_distance"><strong>Hamming Distance</strong></a></li><li><a href="https://en.wikipedia.org/wiki/Levenshtein_distance"><strong>Levenshtein Distance</strong></a> (although I‚Äôm positive I didn‚Äôt spell it correctly in the interview)</li></ul><p>From the quick research, I decided on using Levenshtein distance given it‚Äôs a bit more modern and sophisticated than the hamming distance.</p><p>So the general idea is going to be, we:</p><ol><li>Build a matrix that shows the Levenshtein distance from one data point to the next</li><li>Find the most similar data point based on the above distance</li><li>Merge into a cluster</li><li>Repeat until only a single cluster</li><li>Generate our fun dendogram</li></ol><h2 id="how-to-identify-the-new-clusters-center">How to identify the new clusters center?</h2><p>Here is where we‚Äôre going to use the linkage type and leave the clusters as one, but just compute the distance. We‚Äôll use <code class="language-plaintext highlighter-rouge">Single</code> as our linkage type, meaning we‚Äôll be looking for the minimum.</p><h1 id="part-4---ground-up-implementation-Ô∏è">Part 4 - Ground Up Implementation üë∑‚Äç‚ôÇÔ∏è</h1><p>This section is going to be focused on a bit more to the question I saw, where we‚Äôre doing things from the ground up so that we can better understand the actual algorithm.</p><p>This is not going to be as performant, or as fun, as part 5, so if you just want to skip to that section, be my guest.</p><h2 id="heart-of-the-implementation">Heart of the Implementation</h2><p>You can definitely check out the <a href="https://github.com/johnlarkin1/hierarchical-agglomerative-clustering/tree/main">code here</a>, but I wanted to showcase the heart of the manual implementation for the Hierarchical Clustering Algorithm.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">hierarchical_clustering_from_scratch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">should_enforce_stopping_criteria</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="s">"""
        Performs the hierarchical clustering algorithm.

        1. Builds our distance matrix.
        2. Initiative all points as their own cluster.
        3. Finds the closest clusters.
        4. Iteratively merges the closest clusters.
        5. Updates the distance matrix.
        6. Repeat steps 3-5 until we have a single cluster.
        """</span>

        <span class="c1"># 1. Build distance matrix
</span>        <span class="o">@</span><span class="n">timing_decorator</span>
        <span class="k">def</span> <span class="nf">build_distance_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="s">"""
            Builds the distance matrix for our data.

            The distance matrix is a square matrix that contains the pairwise distances
            between each point in our data.
            """</span>

            <span class="n">num_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">[</span><span class="s">"retailer_nm_modified"</span><span class="p">].</span><span class="n">values</span><span class="p">)</span>
            <span class="n">distance_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rows</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">):</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="n">compute_distance</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="c1"># distance matrix is symmetrical
</span>                    <span class="n">distance_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span>
                    <span class="n">distance_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span>
            <span class="k">return</span> <span class="n">distance_matrix</span>

        <span class="n">distance_matrix</span> <span class="o">=</span> <span class="n">build_distance_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">)</span>
        <span class="n">cluster_id_to_dendrogram_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)}</span>
        <span class="n">next_cluster_index</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">dendrogram_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># 2. Initialize all points as their own cluster
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">[</span><span class="s">"cluster_id"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">.</span><span class="n">index</span>
        <span class="n">index_to_cluster_id</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">i</span><span class="p">:</span> <span class="n">cluster_id</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">[</span><span class="s">"cluster_id"</span><span class="p">])</span>
        <span class="p">}</span>

        <span class="o">@</span><span class="n">timing_decorator</span>
        <span class="k">def</span> <span class="nf">find_closest_clusters</span><span class="p">(</span>
            <span class="n">distance_matrix</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span>
            <span class="n">index_to_cluster_id</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
            <span class="s">"""
            Finds the two closest clusters in our data.

            We'll use the distance matrix to find the two closest clusters.
            """</span>
            <span class="n">min_val</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">inf</span>
            <span class="n">cluster_index_a</span><span class="p">,</span> <span class="n">cluster_index_b</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">distance_matrix</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>  <span class="c1"># Ensure i != j
</span>                    <span class="c1"># Check if i and j belong to different clusters before comparing distances
</span>                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">distance_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_val</span>
                        <span class="ow">and</span> <span class="n">index_to_cluster_id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">index_to_cluster_id</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">min_val</span> <span class="o">=</span> <span class="n">distance_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="n">cluster_index_a</span><span class="p">,</span> <span class="n">cluster_index_b</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>

            <span class="n">cluster_a_id</span> <span class="o">=</span> <span class="n">index_to_cluster_id</span><span class="p">[</span><span class="n">cluster_index_a</span><span class="p">]</span>
            <span class="n">cluster_b_id</span> <span class="o">=</span> <span class="n">index_to_cluster_id</span><span class="p">[</span><span class="n">cluster_index_b</span><span class="p">]</span>
            <span class="c1"># Additional check to ensure cluster IDs are distinct could be added here, if necessary
</span>            <span class="k">return</span> <span class="n">cluster_a_id</span><span class="p">,</span> <span class="n">cluster_b_id</span><span class="p">,</span> <span class="n">cluster_index_a</span><span class="p">,</span> <span class="n">cluster_index_b</span>

        <span class="o">@</span><span class="n">timing_decorator</span>
        <span class="k">def</span> <span class="nf">merge_closest_clusters</span><span class="p">(</span>
            <span class="n">cluster_a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">cluster_b</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">cluster_index_a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">cluster_index_b</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="s">"""
            Merges the two closest clusters in our actual dataframe.
            We don't touch our distance matrix yet.

            We'll merge the two closest clusters and update the cluster_id column
            in our data.
            """</span>
            <span class="k">nonlocal</span> <span class="n">next_cluster_index</span>

            <span class="c1"># Update the cluster_id for all points in cluster_b
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">[</span><span class="s">"cluster_id"</span><span class="p">]</span> <span class="o">==</span> <span class="n">cluster_b</span><span class="p">,</span> <span class="s">"cluster_id"</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">cluster_a</span>
            <span class="n">merge_distance</span> <span class="o">=</span> <span class="n">distance_matrix</span><span class="p">[</span><span class="n">cluster_index_a</span><span class="p">,</span> <span class="n">cluster_index_b</span><span class="p">]</span>
            <span class="n">new_cluster_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">[</span><span class="s">"cluster_id"</span><span class="p">]</span> <span class="o">==</span> <span class="n">cluster_a</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">dendrogram_data</span><span class="p">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">cluster_id_to_dendrogram_index</span><span class="p">[</span><span class="n">cluster_a</span><span class="p">],</span>
                    <span class="n">cluster_id_to_dendrogram_index</span><span class="p">[</span><span class="n">cluster_b</span><span class="p">],</span>
                    <span class="n">merge_distance</span><span class="p">,</span>
                    <span class="n">new_cluster_size</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">cluster_id_to_dendrogram_index</span><span class="p">[</span><span class="n">cluster_a</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_cluster_index</span>
            <span class="n">cluster_id_to_dendrogram_index</span><span class="p">[</span><span class="n">cluster_b</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_cluster_index</span>

            <span class="n">next_cluster_index</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Prepare for the next merge
</span>            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span>

        <span class="o">@</span><span class="n">timing_decorator</span>
        <span class="k">def</span> <span class="nf">update_distance_matrix</span><span class="p">(</span><span class="n">dist_matrix</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">cluster_a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">cluster_b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># We always merge cluster_b into cluster_a
</span>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">index_to_cluster_id</span><span class="p">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">cluster_id</span> <span class="o">==</span> <span class="n">cluster_b</span><span class="p">:</span>
                    <span class="n">index_to_cluster_id</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_a</span>

            <span class="c1"># Set diagonal to np.inf to ignore self-distances
</span>            <span class="n">np</span><span class="p">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">dist_matrix</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">inf</span><span class="p">)</span>

            <span class="c1"># Recompute distances for the new cluster
</span>            <span class="c1"># We only need to update the distances for when
</span>            <span class="c1"># the distance matrix is referencing cluster_a or cluster_b
</span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dist_matrix</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dist_matrix</span><span class="p">)):</span>
                    <span class="c1"># Get the cluster IDs for points i and j
</span>                    <span class="n">cluster_id_i</span> <span class="o">=</span> <span class="n">index_to_cluster_id</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">cluster_id_j</span> <span class="o">=</span> <span class="n">index_to_cluster_id</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

                    <span class="c1"># If i or j is part of the newly merged cluster, recalculate the distance
</span>                    <span class="k">if</span> <span class="n">cluster_id_i</span> <span class="o">==</span> <span class="n">cluster_a</span> <span class="ow">or</span> <span class="n">cluster_id_j</span> <span class="o">==</span> <span class="n">cluster_a</span><span class="p">:</span>
                        <span class="n">new_distance</span> <span class="o">=</span> <span class="n">calculate_new_distance</span><span class="p">(</span>
                            <span class="n">cluster_a</span><span class="p">,</span>
                            <span class="n">cluster_b</span><span class="p">,</span>
                            <span class="n">cluster_id_j</span> <span class="k">if</span> <span class="n">cluster_id_i</span> <span class="o">==</span> <span class="n">cluster_a</span> <span class="k">else</span> <span class="n">cluster_id_i</span><span class="p">,</span>
                            <span class="bp">self</span><span class="p">.</span><span class="n">linkage_type</span><span class="p">,</span>
                            <span class="n">dist_matrix</span><span class="p">,</span>
                            <span class="n">index_to_cluster_id</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">dist_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_distance</span>
                        <span class="n">dist_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_distance</span>
            <span class="k">return</span> <span class="n">dist_matrix</span><span class="p">,</span> <span class="n">index_to_cluster_id</span>

        <span class="c1"># Now we loop until we have a single cluster
</span>        <span class="n">unique_retailer_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">[</span><span class="s">"retailer_nm"</span><span class="p">].</span><span class="n">unique</span><span class="p">())</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">[</span><span class="s">"cluster_id"</span><span class="p">].</span><span class="n">unique</span><span class="p">())</span> <span class="o">&gt;</span> <span class="p">(</span>
            <span class="n">unique_retailer_count</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">should_enforce_stopping_criteria</span> <span class="ow">or</span> <span class="bp">self</span><span class="p">.</span><span class="n">should_enforce_stopping_criteria</span><span class="p">)</span>
            <span class="k">else</span> <span class="mi">1</span>
        <span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Number of clusters:"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">[</span><span class="s">"cluster_id"</span><span class="p">].</span><span class="n">unique</span><span class="p">()))</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

            <span class="c1"># 3. Find the closest clusters
</span>            <span class="n">cluster_a</span><span class="p">,</span> <span class="n">cluster_b</span><span class="p">,</span> <span class="n">cluster_index_a</span><span class="p">,</span> <span class="n">cluster_index_b</span> <span class="o">=</span> <span class="n">find_closest_clusters</span><span class="p">(</span>
                <span class="n">distance_matrix</span><span class="p">,</span> <span class="n">index_to_cluster_id</span>
            <span class="p">)</span>
            <span class="c1"># 4. Merge the closest clusters in our
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span> <span class="o">=</span> <span class="n">merge_closest_clusters</span><span class="p">(</span>
                <span class="n">cluster_a</span><span class="p">,</span> <span class="n">cluster_b</span><span class="p">,</span> <span class="n">cluster_index_a</span><span class="p">,</span> <span class="n">cluster_index_b</span>
            <span class="p">)</span>
            <span class="c1"># 5. Update the distance matrix
</span>            <span class="n">distance_matrix</span><span class="p">,</span> <span class="n">index_to_cluster_id</span> <span class="o">=</span> <span class="n">update_distance_matrix</span><span class="p">(</span>
                <span class="n">distance_matrix</span><span class="p">,</span> <span class="n">cluster_a</span><span class="p">,</span> <span class="n">cluster_b</span>
            <span class="p">)</span>

            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Elapsed time of clustering loop:"</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="p">,</span> <span class="s">"seconds"</span><span class="p">)</span>

        <span class="c1"># Only try to show the dendrogram if we have the full merge history
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">should_enforce_stopping_criteria</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">should_enforce_stopping_criteria</span><span class="p">:</span>
            <span class="n">sns</span><span class="p">.</span><span class="n">set_style</span><span class="p">(</span><span class="s">"darkgrid"</span><span class="p">)</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
            <span class="n">linkage_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">dendrogram_data</span><span class="p">)</span>
            <span class="n">np</span><span class="p">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s">"data/output/linkage_matrix.csv"</span><span class="p">,</span> <span class="n">linkage_matrix</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">","</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Dendrogram Data:"</span><span class="p">,</span> <span class="n">dendrogram_data</span><span class="p">)</span>

            <span class="n">n_clusters</span> <span class="o">=</span> <span class="n">linkage_matrix</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s">"Sample </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_clusters</span><span class="p">)]</span>

            <span class="n">dendrogram</span><span class="p">(</span>
                <span class="n">linkage_matrix</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="s">"top"</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="n">distance_sort</span><span class="o">=</span><span class="s">"descending"</span><span class="p">,</span>
                <span class="n">show_leaf_counts</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                <span class="n">leaf_rotation</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span>
                <span class="n">leaf_font_size</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
                <span class="n">color_threshold</span><span class="o">=</span><span class="mf">0.7</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">linkage_matrix</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]),</span>
                <span class="n">above_threshold_color</span><span class="o">=</span><span class="s">"grey"</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Hierarchical Clustering Dendrogram"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Index"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Distance"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">output_dendrogram_path</span><span class="p">)</span>
            <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span>
</code></pre></div></div><h2 id="questions-that-arose">Questions that Arose</h2><h3 id="early-stopping-criterion">Early Stopping Criterion</h3><p>One thing to note is that the whole point of the Hierarchical Clustering Algorithm is that we converge to a single cluster. That‚Äôs a little bit different than what we want here, because we want to have a cluster_id per each retailer. So there‚Äôs two things we can do here: 1) stop when we have the number of clusters we know (given we have the retailer_nm and so we‚Äôll know the number of unique clusters) 2) generate an interactive dendrogram and then try to pick various cutoff points based on the number of clusters.</p><p><strong>As a result, in our slight variation of Hierarchical Clustering Algorithm, we‚Äôre going to implement a stopping criterion which correlates to the number of unique retailer names.</strong></p><h3 id="mapping-generated-clusterids-to-ground-truth-label">Mapping Generated ClusterIds to Ground Truth Label</h3><p>So we‚Äôll have our early stopping criterion, but then the question arises of how do we map <strong><em>OUR</em></strong> generated <code class="language-plaintext highlighter-rouge">cluster_ids</code> to the <code class="language-plaintext highlighter-rouge">ground_truth_labels</code>.</p><p><strong>I think the best way to do this is to identify per our computed cluster the most frequent (i.e. the <a href="https://en.wikipedia.org/wiki/Mode_(statistics)">mode</a>) <code class="language-plaintext highlighter-rouge">ground_truth_label</code> that we‚Äôve seen and then map it accordingly.</strong></p><p>Basically, a simple example would be like this:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'ground_truth_label'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
<span class="p">...</span>         <span class="s">'cluster_id'</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Group by cluster_id and ground_truth_label, and count occurrences
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'cluster_id'</span><span class="p">,</span> <span class="s">'ground_truth_label'</span><span class="p">]).</span><span class="n">size</span><span class="p">().</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'count'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Sort the grouped data to ensure the mode (highest count) comes first
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">grouped_sorted</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">'cluster_id'</span><span class="p">,</span> <span class="s">'count'</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Drop duplicates to ensure one-to-one mapping, keeping the first occurrence (the mode)
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">unique_mapping</span> <span class="o">=</span> <span class="n">grouped_sorted</span><span class="p">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s">'cluster_id'</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s">'first'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Create the mapping dictionary
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">mapping_dict</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">(</span><span class="n">unique_mapping</span><span class="p">.</span><span class="n">ground_truth_label</span><span class="p">.</span><span class="n">values</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">unique_mapping</span><span class="p">.</span><span class="n">cluster_id</span><span class="p">).</span><span class="n">to_dict</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">mapping_dict</span><span class="p">)</span>
<span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</code></pre></div></div><h3 id="plotting-a-dendrogram">Plotting a Dendrogram</h3><p>For sure the most annoying part of this whole project was trying to build out the apporpriate linkage matrix to pass to <code class="language-plaintext highlighter-rouge">scipy</code>‚Äôs <code class="language-plaintext highlighter-rouge">dendrogram</code>.</p><p>Partially the issue was indexing and partially the issue was that we‚Äôre stopping early so some of the structure about the linkage matrix (described <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.cluster.hierarchy.linkage.html#scipy.cluster.hierarchy.linkage">here</a>) was inherently incorrect.</p><p>It was annoying, but if you want to see some fun visualizations, check it out here: <a href="#dendrogram-visualization">Dendrogram Visualization</a>.</p><h1 id="part-5---polished-implementation-">Part 5 - Polished Implementation üíÖ</h1><p>So again, all of the above, and all of the <a href="https://github.com/johnlarkin1/hierarchical-agglomerative-clustering/tree/main">code found here</a> was largely aimed at implementing the hierarchical clustering algorithm from scratch.</p><p>This section is trying to utilize 3rd party libraries to perform that our self.</p><p>At first I thought it would be best if there was two separate scripts to do the clustering, but after writing the code, I decided that some input or feature flags at the top of the script would work just as well.</p><p>So I refactored my code to include this portion.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SHOULD_USE_THIRD_PARTY</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># more code
</span>
    <span class="o">@</span><span class="n">timing_decorator</span>
    <span class="k">def</span> <span class="nf">hierarchical_clustering</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">should_enforce_stopping_criteria</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">SHOULD_USE_THIRD_PARTY</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">hierarchical_clustering_from_third_party</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">hierarchical_clustering_from_scratch</span><span class="p">(</span><span class="n">should_enforce_stopping_criteria</span><span class="p">)</span>
</code></pre></div></div><p>The actual implementation is very simple, so I‚Äôll include that here:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">hierarchical_clustering_from_third_party</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="s">"""
        Performs the hierarchical clustering algorithm using a third-party library.
        """</span>
        <span class="n">retailer_nm_modified</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">[</span><span class="s">"retailer_nm_modified"</span><span class="p">].</span><span class="n">values</span>

        <span class="c1"># Calculate the Levenshtein distance matrix in a condensed form
</span>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">retailer_nm_modified</span><span class="p">)</span>
        <span class="n">condensed_dist_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">condensed_dist_matrix</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">levenshtein_distance</span><span class="p">(</span>
                    <span class="n">retailer_nm_modified</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">retailer_nm_modified</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">Z</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">condensed_dist_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">linkage_type</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">desired_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">[</span><span class="s">"retailer_nm"</span><span class="p">].</span><span class="n">unique</span><span class="p">())</span>
        <span class="n">cluster_labels</span> <span class="o">=</span> <span class="n">fcluster</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">desired_clusters</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s">"maxclust"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">processed_data</span><span class="p">[</span><span class="s">"cluster_id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_labels</span>
</code></pre></div></div><h1 id="takeways---how-did-we-do">Takeways - how did we do?!</h1><p>Honestly? Pretty well!</p><div class="table-wrapper" style="display: block; /* or display: flex; */ width: 1200px; margin-left: auto; margin-right: auto; position: relative; /* if needed */ left: 50%; transform: translateX(-50%);"><table><thead><tr><th style="text-align: center">Dataset</th><th style="text-align: center">Distance Algorithm</th><th style="text-align: center">Linkage Method</th><th style="text-align: center">Implementation</th><th style="text-align: center">F1 Score</th><th style="text-align: center">Confusion Matrix</th><th style="text-align: center">Dendrogram<br />(feel free to open in new tab!)</th><th style="text-align: center">Time for Algo Step<br />(full clustering, seconds)</th></tr></thead><tbody><tr><td style="text-align: center">simple</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">single</td><td style="text-align: center">scratch</td><td style="text-align: center" class="f1-score">0.7934</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                  <code>
[[ 6  0  0  2  0  0  0  0  0  0  0  0  0]
[ 0  9  0  0  0  0  0  0  0  0  0  0  0]
[ 0  0  9  0  0  0  0  0  0  0  0  0  0]
[ 0  0  0 10  0  0  0  0  0  0  0  0  0]
[ 0  0  0  2  2  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0 12  0  0  0  0  0  0  0]
[ 0  0  0  3  0  0  8  0  0  0  0  0  0]
[ 4  0  0  1  0  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0  0  0  0  8  0  0  0  0]
[ 0  0  0  0  0  0  0  0  0  2  0  0  0]
[ 0  0  0  2  0  0  0  0  0  0  9  0  0]
[ 0  0  0  1  0  0  0  0  0  0  0  6  0]
[ 0  0  0  4  0  0  0  0  0  0  0  0  0]]
                  </code>
              </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_scratch_simple_single_leven.png" alt="dendrogram_scratch_simple_single_leven" /> </details></td><td style="text-align: center" class="cluster-time">44.7954</td></tr><tr><td style="text-align: center">simple</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">single</td><td style="text-align: center">3rd party</td><td style="text-align: center" class="f1-score">0.7934</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[ 6  0  0  2  0  0  0  0  0  0  0  0  0]
[ 0  9  0  0  0  0  0  0  0  0  0  0  0]
[ 0  0  9  0  0  0  0  0  0  0  0  0  0]
[ 0  0  0 10  0  0  0  0  0  0  0  0  0]
[ 0  0  0  2  2  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0 12  0  0  0  0  0  0  0]
[ 0  0  0  3  0  0  8  0  0  0  0  0  0]
[ 4  0  0  1  0  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0  0  0  0  8  0  0  0  0]
[ 0  0  0  0  0  0  0  0  0  2  0  0  0]
[ 0  0  0  2  0  0  0  0  0  0  9  0  0]
[ 0  0  0  1  0  0  0  0  0  0  0  6  0]
[ 0  0  0  4  0  0  0  0  0  0  0  0  0]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_3rd_party_simple_single_leven.png" alt="dendrogram_3rd_party_simple_single_leven" /> </details></td><td style="text-align: center" class="cluster-time">2.8021</td></tr><tr><td style="text-align: center">simple</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">complete</td><td style="text-align: center">scratch</td><td style="text-align: center" class="f1-score">0.8203</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[ 6  0  0  2  0  0  0  0  0  0  0  0  0]
[ 0  9  0  0  0  0  0  0  0  0  0  0  0]
[ 0  0  9  0  0  0  0  0  0  0  0  0  0]
[ 0  0  0 10  0  0  0  0  0  0  0  0  0]
[ 0  0  0  2  2  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0 12  0  0  0  0  0  0  0]
[ 0  0  0  3  0  0  8  0  0  0  0  0  0]
[ 4  0  0  1  0  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0  0  0  0  6  0  2  0  0]
[ 0  0  0  0  0  0  0  0  0  2  0  0  0]
[ 0  0  0  2  0  0  0  0  0  0  9  0  0]
[ 0  0  0  1  0  0  0  0  0  0  0  6  0]
[ 0  0  0  0  0  0  0  0  0  0  0  0  4]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_scratch_simple_complete_leven.png" alt="dendrogram_scratch_simple_complete_leven" /> </details></td><td style="text-align: center" class="cluster-time">27.1838</td></tr><tr><td style="text-align: center">simple</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">complete</td><td style="text-align: center">3rd party</td><td style="text-align: center" class="f1-score">0.7913</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[ 6  0  0  2  0  0  0  0  0  0  0  0  0]
[ 0  9  0  0  0  0  0  0  0  0  0  0  0]
[ 0  0  9  0  0  0  0  0  0  0  0  0  0]
[ 0  0  0 10  0  0  0  0  0  0  0  0  0]
[ 0  0  0  2  2  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0 12  0  0  0  0  0  0  0]
[ 0  0  0  3  0  0  8  0  0  0  0  0  0]
[ 4  0  0  1  0  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0  0  0  0  6  0  2  0  0]
[ 0  0  2  0  0  0  0  0  0  0  0  0  0]
[ 0  0  0  2  0  0  0  0  0  0  9  0  0]
[ 0  0  0  1  0  0  0  0  0  0  0  6  0]
[ 0  0  0  0  0  0  0  0  0  0  0  0  4]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_3rd_party_simple_complete_leven.png" alt="dendrogram_3rd_party_simple_complete_leven" /> </details></td><td style="text-align: center" class="cluster-time">5.2054</td></tr><tr><td style="text-align: center">simple</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">average</td><td style="text-align: center">scratch</td><td style="text-align: center" class="f1-score">0.8203</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[ 6  0  0  2  0  0  0  0  0  0  0  0  0]
[ 0  9  0  0  0  0  0  0  0  0  0  0  0]
[ 0  0  9  0  0  0  0  0  0  0  0  0  0]
[ 0  0  0 10  0  0  0  0  0  0  0  0  0]
[ 0  0  0  2  2  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0 12  0  0  0  0  0  0  0]
[ 0  0  0  3  0  0  8  0  0  0  0  0  0]
[ 4  0  0  1  0  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0  0  0  0  6  0  2  0  0]
[ 0  0  0  0  0  0  0  0  0  2  0  0  0]
[ 0  0  0  2  0  0  0  0  0  0  9  0  0]
[ 0  0  0  1  0  0  0  0  0  0  0  6  0]
[ 0  0  0  0  0  0  0  0  0  0  0  0  4]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_scratch_simple_average_leven.png" alt="dendrogram_scratch_simple_average_leven" /> </details></td><td style="text-align: center" class="cluster-time">72.2544</td></tr><tr><td style="text-align: center">simple</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">average</td><td style="text-align: center">3rd party</td><td style="text-align: center" class="f1-score">0.7913</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[ 6  0  0  2  0  0  0  0  0  0  0  0  0]
[ 0  9  0  0  0  0  0  0  0  0  0  0  0]
[ 0  0  9  0  0  0  0  0  0  0  0  0  0]
[ 0  0  0 10  0  0  0  0  0  0  0  0  0]
[ 0  0  0  2  2  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0 12  0  0  0  0  0  0  0]
[ 0  0  0  3  0  0  8  0  0  0  0  0  0]
[ 4  0  0  1  0  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0  0  0  0  6  0  2  0  0]
[ 0  0  2  0  0  0  0  0  0  0  0  0  0]
[ 0  0  0  2  0  0  0  0  0  0  9  0  0]
[ 0  0  0  1  0  0  0  0  0  0  0  6  0]
[ 0  0  0  0  0  0  0  0  0  0  0  0  4]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_3rd_party_simple_average_leven.png" alt="dendrogram_3rd_party_simple_average_leven" /> </details></td><td style="text-align: center" class="cluster-time">2.7315</td></tr><tr><td style="text-align: center">simple</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">ward</td><td style="text-align: center">scratch</td><td style="text-align: center" class="f1-score">N/A</td><td style="text-align: center">N/A</td><td style="text-align: center">N/A</td><td style="text-align: center">N/A</td></tr><tr><td style="text-align: center">simple</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">ward</td><td style="text-align: center">3rd party</td><td style="text-align: center" class="f1-score">0.8118</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[ 6  0  0  2  0  0  0  0  0  0  0  0  0]
[ 0  9  0  0  0  0  0  0  0  0  0  0  0]
[ 0  0  9  0  0  0  0  0  0  0  0  0  0]
[ 0  0  0 10  0  0  0  0  0  0  0  0  0]
[ 0  0  0  2  2  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0 12  0  0  0  0  0  0  0]
[ 0  0  0  3  0  0  8  0  0  0  0  0  0]
[ 4  0  0  1  0  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0  0  0  0  8  0  0  0  0]
[ 0  0  2  0  0  0  0  0  0  0  0  0  0]
[ 0  0  0  2  0  0  0  0  0  0  9  0  0]
[ 0  0  0  1  0  0  0  0  0  0  0  6  0]
[ 0  0  0  0  0  0  0  0  0  0  0  0  4]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_3rd_party_simple_ward_leven.png" alt="dendrogram_3rd_party_simple_ward_leven" /> </details></td><td style="text-align: center" class="cluster-time">2.2091</td></tr><tr><td style="text-align: center">simple</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">centroid</td><td style="text-align: center">scratch</td><td style="text-align: center" class="f1-score">N/A</td><td style="text-align: center">N/A</td><td style="text-align: center">N/A</td><td style="text-align: center">N/A</td></tr><tr><td style="text-align: center">simple</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">centroid</td><td style="text-align: center">3rd party</td><td style="text-align: center" class="f1-score">0.8118</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[ 6  0  0  2  0  0  0  0  0  0  0  0  0]
[ 0  9  0  0  0  0  0  0  0  0  0  0  0]
[ 0  0  9  0  0  0  0  0  0  0  0  0  0]
[ 0  0  0 10  0  0  0  0  0  0  0  0  0]
[ 0  0  0  2  2  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0 12  0  0  0  0  0  0  0]
[ 0  0  0  3  0  0  8  0  0  0  0  0  0]
[ 4  0  0  1  0  0  0  0  0  0  0  0  0]
[ 0  0  0  0  0  0  0  0  8  0  0  0  0]
[ 0  0  2  0  0  0  0  0  0  0  0  0  0]
[ 0  0  0  2  0  0  0  0  0  0  9  0  0]
[ 0  0  0  1  0  0  0  0  0  0  0  6  0]
[ 0  0  0  0  0  0  0  0  0  0  0  0  4]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_3rd_party_simple_centroid_leven.png" alt="dendrogram_3rd_party_simple_centroid_leven" /> </details></td><td style="text-align: center" class="cluster-time">1.7993</td></tr><tr><td style="text-align: center">complex</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">single</td><td style="text-align: center">scratch</td><td style="text-align: center" class="f1-score">0.2283</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[ 1  0 32  0  0  0  0  0  0  0  0  0  0]
[ 0  2 26  0  0  0  0  0  0  0  0  0  0]
[ 0  0 44  0  0  0  0  0  0  0  0  0  0]
[ 0  0 39  0  0  0  0  0  0  0  0  0  0]
[ 0  0 30  0  0  0  0  0  0  0  0  0  0]
[ 0  0  4  0  0 22  0  0  0  0  0  0  0]
[ 0  0  2  0  0  0 21  0  0  0  0  0  0]
[ 0  0 26  0  0  0  0  2  0  0  0  0  0]
[ 0  0 28  0  0  0  0  0  0  0  0  0  0]
[ 0  0  4  0  0  0  0  0  0 22  0  0  0]
[ 0  0 23  0  0  0  0  0  0  0  1  0  0]
[ 0  0 35  0  0  0  0  0  0  0  0  0  0]
[ 0  0 36  0  0  0  0  0  0  0  0  0  0]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_scratch_complex_single_leven.png" alt="dendrogram_scratch_complex_single_leven" /> </details></td><td style="text-align: center" class="cluster-time">87855.6781</td></tr><tr><td style="text-align: center">complex</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">single</td><td style="text-align: center">3rd party</td><td style="text-align: center" class="f1-score">0.2045</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[ 1  0 32  0  0  0  0  0  0  0  0  0  0]
[ 0  0 28  0  0  0  0  0  0  0  0  0  0]
[ 0  0 44  0  0  0  0  0  0  0  0  0  0]
[ 0  0 39  0  0  0  0  0  0  0  0  0  0]
[ 0  0 30  0  0  0  0  0  0  0  0  0  0]
[ 0  0  4  0  0 22  0  0  0  0  0  0  0]
[ 0  0  2  0  0  0 21  0  0  0  0  0  0]
[ 0  0 28  0  0  0  0  0  0  0  0  0  0]
[ 0  0 28  0  0  0  0  0  0  0  0  0  0]
[ 0  0  4  0  0  0  0  0  0 22  0  0  0]
[ 0  0 24  0  0  0  0  0  0  0  0  0  0]
[ 0  0 35  0  0  0  0  0  0  0  0  0  0]
[ 0  0 36  0  0  0  0  0  0  0  0  0  0]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_3rd_party_complex_single_leven.png" alt="dendrogram_3rd_party_complex_single_leven" /> </details></td><td style="text-align: center" class="cluster-time">2.0232</td></tr><tr><td style="text-align: center">complex</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">complete</td><td style="text-align: center">scratch</td><td style="text-align: center" class="f1-score">0.7025</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[29  0  4  0  0  0  0  0  0  0  0  0  0]
[ 0 27  1  0  0  0  0  0  0  0  0  0  0]
[ 0  0 44  0  0  0  0  0  0  0  0  0  0]
[ 0  0 39  0  0  0  0  0  0  0  0  0  0]
[ 0  0  7  0 23  0  0  0  0  0  0  0  0]
[ 0  0  4  0  0 22  0  0  0  0  0  0  0]
[ 0  0  2  0  0  0 21  0  0  0  0  0  0]
[ 0  0  4  0  0  0  0 24  0  0  0  0  0]
[ 0  0 23  0  0  0  0  0  0  0  0  5  0]
[ 0  0  4  0  0  0  0  0  0 22  0  0  0]
[ 0  0  2  0  0  0  0  0  0  0 22  0  0]
[ 0  0  9  0  0  0  0  0  0  0  0 26  0]
[ 0  0  9  0  0  0  0  0  0  0  0  0 27]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_scratch_complex_complete_leven.png" alt="dendrogram_scratch_complex_complete_leven" /> </details></td><td style="text-align: center" class="cluster-time">7232.4973</td></tr><tr><td style="text-align: center">complex</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">complete</td><td style="text-align: center">3rd party</td><td style="text-align: center" class="f1-score">0.6157</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[29  0  4  0  0  0  0  0  0  0  0  0  0]
[ 0 27  1  0  0  0  0  0  0  0  0  0  0]
[ 0  0 44  0  0  0  0  0  0  0  0  0  0]
[ 0  0 35  0  0  0  0  0  0  0  4  0  0]
[ 0  0  7  0 23  0  0  0  0  0  0  0  0]
[ 0  0  4  0  0 22  0  0  0  0  0  0  0]
[ 0  0  2  0  0  0 21  0  0  0  0  0  0]
[ 0  0  4  0  0  0  0 24  0  0  0  0  0]
[ 0  0 23  0  0  0  0  0  0  0  5  0  0]
[ 0  0  4  0  0  0  0  0  0 22  0  0  0]
[ 0  0  2  0  0  0  0  0  0  0 22  0  0]
[ 0  0 29  0  0  0  0  0  0  0  6  0  0]
[ 0  0  9  0  0  0  0  0  0  0  0  0 27]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_3rd_party_complex_complete_leven.png" alt="dendrogram_3rd_party_complex_complete_leven" /> </details></td><td style="text-align: center" class="cluster-time">2.1442</td></tr><tr><td style="text-align: center">complex</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">average</td><td style="text-align: center">scratch</td><td style="text-align: center" class="f1-score">0.6955</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[31  0  2  0  0  0  0  0  0  0  0  0  0]
[ 0 27  1  0  0  0  0  0  0  0  0  0  0]
[ 0  0 44  0  0  0  0  0  0  0  0  0  0]
[ 0  0 30  0  0  0  0  0  0  0  0  9  0]
[ 0  0  7  0 23  0  0  0  0  0  0  0  0]
[ 0  0  4  0  0 22  0  0  0  0  0  0  0]
[ 0  0  2  0  0  0 21  0  0  0  0  0  0]
[ 0  0  4  0  0  0  0 24  0  0  0  0  0]
[ 0  0  5  0  0  0  0  0  0  0  0 23  0]
[ 0  0  4  0  0  0  0  0  0 22  0  0  0]
[ 0  0  2  0  0  0  0  0  0  0 22  0  0]
[ 0  0  8  0  0  0  0  0  0  0  0 27  0]
[ 0  0  9  0  0  0  0  0  0  0  0  0 27]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_scratch_complex_average_leven.png" alt="dendrogram_scratch_complex_average_leven" /> </details></td><td style="text-align: center" class="cluster-time">12005.9713</td></tr><tr><td style="text-align: center">complex</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">average</td><td style="text-align: center">3rd party</td><td style="text-align: center" class="f1-score">0.6937</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[29  0  2  0  0  0  0  2  0  0  0  0  0]
[ 0 27  1  0  0  0  0  0  0  0  0  0  0]
[ 0  0 44  0  0  0  0  0  0  0  0  0  0]
[ 0  0 30  0  0  0  0  0  0  0  0  9  0]
[ 0  0  7  0 23  0  0  0  0  0  0  0  0]
[ 0  0  4  0  0 22  0  0  0  0  0  0  0]
[ 0  0  2  0  0  0 21  0  0  0  0  0  0]
[ 0  0  4  0  0  0  0 24  0  0  0  0  0]
[ 0  0  5  0  0  0  0  0  0  0  0 23  0]
[ 0  0  4  0  0  0  0  0  0 22  0  0  0]
[ 0  0  0  0  0  0  0  0  0  0 24  0  0]
[ 0  0  8  0  0  0  0  0  0  0  0 27  0]
[ 0  0  9  0  0  0  0  0  0  0  0  0 27]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_3rd_party_complex_average_leven.png" alt="dendrogram_3rd_party_complex_average_leven" /> </details></td><td style="text-align: center" class="cluster-time">1.9224</td></tr><tr><td style="text-align: center">complex</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">ward</td><td style="text-align: center">scratch</td><td style="text-align: center" class="f1-score">N/A</td><td style="text-align: center">N/A</td><td style="text-align: center">N/A</td><td style="text-align: center">N/A</td></tr><tr><td style="text-align: center">complex</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">ward</td><td style="text-align: center">3rd party</td><td style="text-align: center" class="f1-score">0.8711</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[29  0  0  4  0  0  0  0  0  0  0  0  0]
[ 0 27  0  1  0  0  0  0  0  0  0  0  0]
[ 0  0 35  9  0  0  0  0  0  0  0  0  0]
[ 0  0  0 35  0  0  0  0  4  0  0  0  0]
[ 0  0  0  7 23  0  0  0  0  0  0  0  0]
[ 0  0  0  4  0 22  0  0  0  0  0  0  0]
[ 0  0  0  2  0  0 21  0  0  0  0  0  0]
[ 0  0  0  4  0  0  0 24  0  0  0  0  0]
[ 0  0  0  5  0  0  0  0 23  0  0  0  0]
[ 0  0  0  4  0  0  0  0  0 22  0  0  0]
[ 0  0  0  0  0  0  0  0  0  0 24  0  0]
[ 0  0  0  8  0  0  0  0  0  0  0 27  0]
[ 0  0  0  9  0  0  0  0  0  0  0  0 27]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_3rd_party_complex_ward_leven.png" alt="dendrogram_3rd_party_complex_ward_leven" /> </details></td><td style="text-align: center" class="cluster-time">3.3757</td></tr><tr><td style="text-align: center">complex</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">centroid</td><td style="text-align: center">scratch</td><td style="text-align: center" class="f1-score">N/A</td><td style="text-align: center">N/A</td><td style="text-align: center">N/A</td><td style="text-align: center">N/A</td></tr><tr><td style="text-align: center">complex</td><td style="text-align: center"> <strong><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">levenshtein</a></strong></td><td style="text-align: center">centroid</td><td style="text-align: center">3rd party</td><td style="text-align: center" class="f1-score">0.6248</td><td style="text-align: center"> <details><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight">
                    <code>
[[29  0  2  0  0  0  0  2  0  0  0  0  0]
[ 0 27  1  0  0  0  0  0  0  0  0  0  0]
[ 0  0 44  0  0  0  0  0  0  0  0  0  0]
[ 0  0 39  0  0  0  0  0  0  0  0  0  0]
[ 0  0  7  0 23  0  0  0  0  0  0  0  0]
[ 0  0  4  0  0 22  0  0  0  0  0  0  0]
[ 0  0  2  0  0  0 21  0  0  0  0  0  0]
[ 0  0  4  0  0  0  0 24  0  0  0  0  0]
[ 0  0 28  0  0  0  0  0  0  0  0  0  0]
[ 0  0  4  0  0  0  0  0  0 22  0  0  0]
[ 0  0  2  0  0  0  0  0  0  0 22  0  0]
[ 0  0 35  0  0  0  0  0  0  0  0  0  0]
[ 0  0  9  0  0  0  0  0  0  0  0  0 27]]
                    </code>
                </pre></div></div></details></td><td style="text-align: center"> <details> <img src="/images/hac/dendrogram_3rd_party_complex_centroid_leven.png" alt="dendrogram_3rd_party_complex_centroid_leven" /> </details></td><td style="text-align: center" class="cluster-time">3.7413</td></tr></tbody></table></div><p>One of the most satisfying things about this was seeing that there were some exact alignments between my implementation and the third party implementation.</p><p>There were also some discrepancies which I kind of figure is because of various optimizations and the fact that scipy‚Äôs example is probably doing some more advanced stuff under the hood, but seeing similar results across the board, made me feel pretty good about my implementation, and furthermore, my understanding that I had fully grokked how this algorithm works.</p><h2 id="misses-">Misses üéØ</h2><h3 id="performance">Performance</h3><p>My implementation was obviously a lot slower, so that wasn‚Äôt great. Granted some of those timing metrics are skewed because I was traveling and so the timing got a bit messed up, but there were some serious compute times given the serial way we were updating our distance functioon.</p><h3 id="distance-function">Distance Function</h3><p>I think Levenshtein distance is still optimal, but I wanted to also explore the <a href="https://en.wikipedia.org/wiki/Jaro%E2%80%93Winkler_distance">Jaro-Winkler Distance</a>, and then also explore a combination of both of them. That being said‚Ä¶ for the sake of time I‚Äôve already spent on this blog post, I did not get a chance to. I constrained myself to only using Levenshtein distance, but I‚Äôd be curious about trying others.</p><h2 id="wins-">Wins üéâ</h2><h3 id="accuracy">Accuracy</h3><p>Pretty good F1 scores! Which was exciting to see. Our native results were pretty compartive to the 3rd party <code class="language-plaintext highlighter-rouge">scipy</code> solution.</p><h3 id="beautiful-visualizations">Beautiful Visualizations</h3><p>See below, but I think these are pretty fun to look at and analyze.</p><h3 id="deeper-understanding-and-new-technical-skills">Deeper Understanding and New Technical Skills</h3><p>I learned a ton during this process and I was pretty fired up with what I built and this post. It‚Äôs definitely one of my favorites.</p><h2 id="next-steps-">Next Steps ü™ú</h2><p>It‚Äôd be lovely if we could try different distance functions.</p><h2 id="dendrogram-visualization">Dendrogram Visualization</h2><p><img src="/images/hac/dendrogram_scratch_simple_single_leven.png" alt="scratch_simple_single_leven" class="center-image" /></p><div class="image-caption">scratch_simple_single_leven</div><p><img src="/images/hac/dendrogram_3rd_party_simple_single_leven.png" alt="3rd_party_simple_single_leven" class="center-image" /></p><div class="image-caption">3rd_party_simple_single_leven</div><p><img src="/images/hac/dendrogram_scratch_simple_complete_leven.png" alt="scratch_simple_complete_leven" class="center-image" /></p><div class="image-caption">scratch_simple_complete_leven</div><p><img src="/images/hac/dendrogram_3rd_party_simple_complete_leven.png" alt="3rd_party_simple_complete_leven" class="center-image" /></p><div class="image-caption">3rd_party_simple_complete_leven</div><p><img src="/images/hac/dendrogram_scratch_simple_average_leven.png" alt="scratch_simple_average_leven" class="center-image" /></p><div class="image-caption">scratch_simple_average_leven</div><p><img src="/images/hac/dendrogram_3rd_party_simple_average_leven.png" alt="3rd_party_simple_average_leven" class="center-image" /></p><div class="image-caption">3rd_party_simple_average_leven</div><p><img src="/images/hac/dendrogram_3rd_party_simple_ward_leven.png" alt="3rd_party_simple_ward_leven" class="center-image" /></p><div class="image-caption">3rd_party_simple_ward_leven</div><p><img src="/images/hac/dendrogram_3rd_party_simple_centroid_leven.png" alt="3rd_party_simple_centroid_leven" class="center-image" /></p><div class="image-caption">3rd_party_simple_centroid_leven</div><p><img src="/images/hac/dendrogram_scratch_complex_single_leven.png" alt="scratch_complex_single_leven" class="center-image" /></p><div class="image-caption">scratch_complex_single_leven</div><p><img src="/images/hac/dendrogram_3rd_party_complex_single_leven.png" alt="3rd_party_complex_single_leven" class="center-image" /></p><div class="image-caption">3rd_party_complex_single_leven</div><p><img src="/images/hac/dendrogram_scratch_complex_complete_leven.png" alt="scratch_complex_complete_leven" class="center-image" /></p><div class="image-caption">scratch_complex_complete_leven</div><p><img src="/images/hac/dendrogram_3rd_party_complex_complete_leven.png" alt="3rd_party_complex_complete_leven" class="center-image" /></p><div class="image-caption">3rd_party_complex_complete_leven</div><p><img src="/images/hac/dendrogram_scratch_complex_average_leven.png" alt="scratch_complex_average_leven" class="center-image" /></p><div class="image-caption">scratch_complex_average_leven</div><p><img src="/images/hac/dendrogram_3rd_party_complex_average_leven.png" alt="3rd_party_complex_average_leven" class="center-image" /></p><div class="image-caption">3rd_party_complex_average_leven</div><p><img src="/images/hac/dendrogram_3rd_party_complex_ward_leven.png" alt="3rd_party_complex_ward_leven" class="center-image" /></p><div class="image-caption">3rd_party_complex_ward_leven</div><p><img src="/images/hac/dendrogram_3rd_party_complex_centroid_leven.png" alt="3rd_party_complex_centroid_leven" class="center-image" /></p><div class="image-caption">3rd_party_complex_centroid_leven</div><div class="footnotes" role="doc-endnotes"><ol><li id="fn:1" role="doc-endnote"><p>https://www.learndatasci.com/glossary/hierarchical-clustering/¬†<a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p></li><li id="fn:2" role="doc-endnote"><p>https://statsandr.com/blog/files/Hierarchical-clustering-cheatsheet.pdf¬†<a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p></li><li id="fn:3" role="doc-endnote"><p>https://towardsdatascience.com/understanding-confusion-matrix-a9ad42dcfd62¬†<a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;</a></p></li></ol></div></article><div class="post-content controls__inner"><div class="controls__item prev"> <span>Previous</span> <a href="/2024/hunger-games/"> <span> <svg xmlns="http://www.w3.org/2000/svg" width="6" height="11"><path fill="fillColor" d="M5.647 1.718c.37-.434.323-1.09-.106-1.465A1.016 1.016 0 0 0 4.095.36L.25 4.875a1.05 1.05 0 0 0 .017 1.378l3.95 4.407c.38.424 1.03.456 1.448.07a1.05 1.05 0 0 0 .07-1.468l-3.34-3.725 3.253-3.819z"/> </svg> </span> The Hunger Games: NYC Edition </a></div><div class="controls__item next"></div></div></div><div class="comments"><div class="container"><div class="post-content"><div id="disqus_thread"></div><script> var disqus_config = function () { this.page.url = 'http://localhost:4000/2024/into-the-arena/'; this.page.identifier = 'http://localhost:4000/2024/into-the-arena/'; }; (function() { var d = document, s = d.createElement('script'); s.src = 'https://jlarks32.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the comments.</noscript></div></div></div></main><footer class="footer"><div class="container"><nav class="social"> <a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/johnlarkin1"> <svg class="social__icon" viewBox="0 0 20 20" width="20px" height="20px"><path d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg> </a></nav><span>&copy; 2024 Where will you go next?. All rights reserved.</span></div></footer><script async src="/assets/js/bundle.js"></script> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } }); </script> <script type="text/javascript" charset="utf-8" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" > </script> <script type="text/javascript" charset="utf-8" src="https://vincenttam.github.io/javascripts/MathJaxLocal.js" > </script></body></html>
